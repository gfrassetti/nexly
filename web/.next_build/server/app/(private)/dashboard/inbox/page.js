(()=>{var e={};e.id=533,e.ids=[533],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},209:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},54045:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>c});var a=t(3003),r=t(14293),n=t(66550),l=t.n(n),i=t(86979),o={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);t.d(s,o);let c=["",{children:["(private)",{children:["dashboard",{children:["inbox",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,55527)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\dashboard\\inbox\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,77173)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,1338)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,52075,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,37973)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,52075,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\dashboard\\inbox\\page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/(private)/dashboard/inbox/page",pathname:"/dashboard/inbox",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},88498:(e,s,t)=>{Promise.resolve().then(t.bind(t,76755))},76755:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(68819),r=t(58838),n=t(74131),l=t(99890),i=t(17266);function o({items:e,activeId:s,onSelect:t,searchQuery:r=""}){let n=(0,i.useMemo)(()=>r.trim()?e.filter(e=>e.title.toLowerCase().includes(r.toLowerCase())||e.last.toLowerCase().includes(r.toLowerCase())):e,[e,r]),l=e=>{try{let s=new Date(e),t=new Date().getTime()-s.getTime(),a=Math.floor(t/6e4),r=Math.floor(a/60),n=Math.floor(r/24);if(a<1)return"Ahora";if(a<60)return`${a}m`;if(r<24)return`${r}h`;if(n<7)return`${n}d`;return s.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch{return e}},o=(e,s)=>{let t=(e||"Sin nombre").split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,a.jsx)("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-full ${{whatsapp:"bg-green-500",instagram:"bg-pink-500",messenger:"bg-blue-500",telegram:"bg-blue-400"}[s]||"bg-neutral-500"} flex items-center justify-center text-accent-cream font-semibold text-xs sm:text-sm`,children:t})};return(0,a.jsx)(a.Fragment,{children:0===n.length?(0,a.jsx)("div",{className:"p-4 text-center text-neutral-400",children:r?(0,a.jsxs)("div",{children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsx)("p",{children:"No se encontraron conversaciones"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Intenta con otros t\xe9rminos de b\xfasqueda"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{children:"No hay conversaciones"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Las nuevas conversaciones aparecer\xe1n aqu\xed"})]})}):(0,a.jsx)("ul",{className:"divide-y divide-neutral-700",children:n.map(e=>(0,a.jsx)("li",{onClick:()=>t(e.id),className:`p-4 hover:bg-neutral-700 cursor-pointer transition-colors ${s===e.id?"bg-neutral-700 border-r-2 border-green-500":""}`,children:(0,a.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:o(e.title,e.platform)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h3",{className:"font-medium text-accent-cream truncate text-sm sm:text-base",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.unread&&(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-xs text-neutral-400 whitespace-nowrap",children:l(e.at)})]})]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-neutral-300 truncate",children:e.last}),"telegram"===e.platform&&e.telegramUsername&&(0,a.jsxs)("p",{className:"text-xs text-neutral-500 truncate",children:["@",e.telegramUsername]}),"telegram"===e.platform&&e.chatType&&(0,a.jsx)("p",{className:"text-xs text-neutral-500 capitalize",children:e.chatType})]})]})},e.id))})})}var c=t(38227);function d({threadId:e,token:s,channel:t,onMessageSent:n}){let l=(0,i.useRef)(null),o=e&&t&&("telegram"===t&&(e.includes("telegram_")||/^\d+$/.test(e))||"whatsapp"===t&&(e.includes("whatsapp_")||/^\d+$/.test(e))||"instagram"===t&&e.includes("instagram_")||"messenger"===t&&(e.includes("messenger_")||/^\d+$/.test(e))),{data:d,mutate:m,isLoading:u}=(0,r.ZP)(e&&s&&o?[`/integrations/conversations/${e}/messages`,s,t]:null,async([s,t,a])=>{let r=s;"telegram"===a&&(r=`/telegram/messages/${e}`);let n=await fetch(`https://nexly-production.up.railway.app${r}`,{headers:{Authorization:`Bearer ${t}`}}),l=await n.json();return l.messages?l.messages.map(e=>{let s="",t="",r="inbound";return"telegram"===a?(s=e.text||"",t=e.date?new Date(e.date).toISOString():new Date().toISOString(),r=e.isOutgoing?"outbound":"inbound"):(s=e.body||e.content||e.text||"",t=e.timestamp||e.date?new Date(e.timestamp||e.date).toISOString():new Date().toISOString(),r="business"===e.from||e.isOutgoing?"outbound":"inbound"),{id:e.id?.toString()||e.messageId||Math.random().toString(),content:s,timestamp:t,direction:r,type:"text",status:e.status||"delivered"}}).reverse():[]},{refreshInterval:5e3,revalidateOnFocus:!0,revalidateOnReconnect:!0}),x=e=>new Date(e).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),h=e=>{switch(e){case"sent":return(0,a.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full"});case"delivered":return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full -ml-1"})]});case"read":return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full -ml-1"})]});default:return null}};return e&&o?u?(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-accent-dark",children:[(0,a.jsx)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(c.O,{className:"h-10 w-10 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-32"}),(0,a.jsx)(c.O,{className:"h-3 w-20"})]}),(0,a.jsx)(c.O,{className:"h-6 w-6 rounded"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-32"}),(0,a.jsx)(c.O,{className:"h-3 w-16"})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-28"}),(0,a.jsx)(c.O,{className:"h-3 w-12"})]})}),(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-40"}),(0,a.jsx)(c.O,{className:"h-3 w-20"})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-36"}),(0,a.jsx)(c.O,{className:"h-3 w-14"})]})}),(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-24"}),(0,a.jsx)(c.O,{className:"h-3 w-18"})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-32"}),(0,a.jsx)(c.O,{className:"h-3 w-16"})]})})]})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-accent-dark",children:[(0,a.jsx)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-accent-cream font-semibold",children:e.slice(0,2).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium text-accent-cream",children:["Conversaci\xf3n ",e]}),(0,a.jsxs)("p",{className:"text-sm text-neutral-400 capitalize",children:[t," • Activo"]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(d||[]).map((e,s)=>(0,a.jsx)("div",{className:`flex ${"outbound"===e.direction?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${"outbound"===e.direction?"bg-green-600 text-accent-cream":"bg-neutral-700 text-accent-cream"}`,children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1",children:[(0,a.jsx)("span",{className:"text-xs opacity-70",children:x(e.timestamp)}),"outbound"===e.direction&&(0,a.jsx)("div",{className:"ml-1",children:h(e.status)})]})]})},e.id)),(0,a.jsx)("div",{ref:l})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center bg-accent-dark",children:(0,a.jsxs)("div",{className:"text-center text-neutral-400",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Selecciona una conversaci\xf3n"}),(0,a.jsxs)("p",{className:"text-sm",children:["Elige una conversaci\xf3n de ",t," para comenzar a chatear"]})]})})}var m=t(18069);function u({message:e,onResponseGenerated:s,onAnalysisComplete:t,disabled:r=!1}){let[n,l]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(null),[x,h]=(0,i.useState)(!1),[p,g]=(0,i.useState)(null),j=async()=>{if(e.trim()&&!r){l(!0),g(null);try{let s=await (0,m.qi)(e.trim());if(s.success)u(s.analysis),t(s.analysis),h(!0);else throw Error("Error en el an\xe1lisis")}catch(e){console.error("Error analizando mensaje:",e),g(e.message||"Error al analizar el mensaje")}finally{l(!1)}}},f=async()=>{if(e.trim()&&!r){c(!0),g(null);try{let t=await (0,m.oJ)(e.trim());if(t.success)s(t.response),h(!1);else throw Error("Error generando respuesta")}catch(e){console.error("Error generando respuesta:",e),g(e.message||"Error al generar respuesta")}finally{c(!1)}}};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:j,disabled:!e.trim()||r||n,className:`
          flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors
          ${!e.trim()||r?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-accent-cream"}
        `,children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{children:"Analizando..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),(0,a.jsx)("span",{children:"IA"})]})}),x&&d&&(0,a.jsx)("div",{className:"absolute bottom-full mb-2 right-0 w-80 bg-gray-800 border border-gray-700 rounded-lg shadow-xl z-50",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-accent-cream",children:"An\xe1lisis de IA"}),(0,a.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-accent-cream",children:(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Sentimiento:"}),(0,a.jsxs)("span",{className:`text-sm font-medium ${(e=>{switch(e){case"positive":return"text-green-500";case"negative":return"text-red-500";default:return"text-gray-500"}})(d.sentiment)}`,children:[(e=>{switch(e){case"positive":return"\uD83D\uDE0A";case"negative":return"\uD83D\uDE1E";default:return"\uD83D\uDE10"}})(d.sentiment)," ",d.sentiment]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Categor\xeda:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-accent-cream",children:[(e=>{switch(e){case"sales":return"\uD83D\uDCB0";case"support":default:return"\uD83D\uDCAC";case"complaint":return"⚠️"}})(d.category)," ",d.category]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Confianza:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-accent-cream",children:[d.confidence,"%"]})]}),d.suggestedResponse&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-300 block mb-1",children:"Respuesta sugerida:"}),(0,a.jsx)("div",{className:"bg-gray-700 p-2 rounded text-sm text-gray-200",children:d.suggestedResponse})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2 mt-4",children:[(0,a.jsx)("button",{onClick:f,disabled:o,className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-accent-cream px-3 py-2 rounded text-sm font-medium transition-colors",children:o?"Generando...":"Usar IA"}),(0,a.jsx)("button",{onClick:()=>h(!1),className:"px-3 py-2 bg-gray-600 hover:bg-gray-700 text-accent-cream rounded text-sm font-medium transition-colors",children:"Cerrar"})]})]})}),p&&(0,a.jsx)("div",{className:"absolute bottom-full mb-2 right-0 w-80 bg-red-800 border border-red-600 rounded-lg shadow-xl z-50 p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-red-200",children:p}),(0,a.jsx)("button",{onClick:()=>g(null),className:"text-red-300 hover:text-red-100",children:(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})}function x({threadId:e,token:s,onSend:t,channel:n="whatsapp",maxLength:l=4096,placeholder:o,onTyping:c,onAttachmentClick:d,disabled:m=!1}){let[x,h]=(0,i.useState)(""),[p,g]=(0,i.useState)(!1),[j,f]=(0,i.useState)(!1),{canSendMessage:v,getRemainingMessages:b,getUsedMessages:N,getMaxMessages:w}=function(e){let{data:s,error:t,mutate:a}=(0,r.ZP)(e?["/messages/limits",e]:null,async([e,s])=>{let t=await fetch(`https://nexly-production.up.railway.app${e}`,{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw Error("Failed to fetch limits");return t.json()}),n=e=>s?.limits&&s.limits.find(s=>s.provider===e)||null;return{limits:s?.limits||[],loading:!s&&!t,error:t,refetch:a,getLimitForProvider:n,canSendMessage:e=>{let s=n(e);return!s||s.canSend},getRemainingMessages:e=>{let s=n(e);return s?s.remaining:999},getUsedMessages:e=>{let s=n(e);return s?s.usedToday:0},getMaxMessages:e=>{let s=n(e);return s?s.maxMessages:999}}}(s),[y,k]=(0,i.useState)(null),[C,M]=(0,i.useState)(!1),L=(0,i.useRef)(null);(0,i.useRef)(null);let A=(0,i.useRef)(null),S=async()=>{if(x.trim()&&!p&&!m){if(x.length>l){k(`El mensaje es demasiado largo (m\xe1ximo ${l} caracteres)`);return}if(!e){k("No hay conversaci\xf3n seleccionada");return}if(!s){k("No est\xe1s autenticado");return}g(!0),k(null);try{await t(x.trim()),h(""),k(null),L.current&&L.current.focus()}catch(e){console.error("❌ Error enviando mensaje:",e),k(e?.message||"Error al enviar el mensaje")}finally{g(!1)}}},$=e=>{let s=L.current;if(s){let t=s.selectionStart,a=s.selectionEnd,r=x.substring(0,t)+e+x.substring(a);r.length<=l&&(h(r),setTimeout(()=>{s.selectionStart=s.selectionEnd=t+e.length,s.focus()},0))}M(!1)};return e?(0,a.jsxs)("div",{className:"border-t border-neutral-700 bg-neutral-800",children:[y&&(0,a.jsx)("div",{className:"px-4 pt-3",children:(0,a.jsx)("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-red-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("span",{className:"text-red-300 text-sm",children:y}),(0,a.jsx)("button",{onClick:()=>k(null),className:"ml-auto text-red-400 hover:text-red-300",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-end gap-3",children:[(0,a.jsx)("input",{ref:A,type:"file",onChange:e=>{let s=e.target.files;s&&s.length>0&&(k("La funci\xf3n de adjuntar archivos estar\xe1 disponible pr\xf3ximamente"),e.target.value="")},className:"hidden",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx"}),(0,a.jsx)("button",{type:"button",onClick:()=>{d?d():A.current?.click()},disabled:m||p,className:"flex-shrink-0 p-2 text-neutral-400 hover:text-neutral-300 disabled:text-neutral-600 disabled:cursor-not-allowed transition-colors",title:"Adjuntar archivo",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,a.jsx)("button",{type:"button",onClick:()=>M(!C),disabled:m||p,className:"flex-shrink-0 p-2 text-neutral-400 hover:text-neutral-300 disabled:text-neutral-600 disabled:cursor-not-allowed transition-colors",title:"Emojis",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("textarea",{ref:L,value:x,onChange:e=>{let s=e.target.value;s.length<=l&&(h(s),k(null))},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},placeholder:o||`Escribe un mensaje en ${(()=>{switch(n.toLowerCase()){case"whatsapp":return"WhatsApp";case"instagram":return"Instagram";case"messenger":return"Messenger";case"telegram":return"Telegram";default:return n}})()}...`,className:"w-full bg-neutral-700 border border-neutral-600 rounded-lg px-4 py-3 pr-12 text-accent-cream placeholder-neutral-400 resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent max-h-32 disabled:opacity-50 disabled:cursor-not-allowed",rows:1,disabled:p||m,maxLength:l}),x.length>0&&(0,a.jsxs)("div",{className:`absolute bottom-1 right-3 text-xs ${x.length>.9*l?"text-yellow-400":x.length>.95*l?"text-red-400":"text-neutral-500"}`,children:[x.length,"/",l]})]}),(0,a.jsx)(u,{message:x,onResponseGenerated:e=>{h(e),setTimeout(()=>{S()},500)},onAnalysisComplete:e=>{},disabled:m}),(0,a.jsx)("button",{onClick:S,disabled:!x.trim()||p||m||x.length>l||!v(n),className:`flex-shrink-0 p-3 rounded-lg transition-colors ${x.trim()&&!p&&!m&&x.length<=l&&v(n)?"bg-green-600 text-accent-cream hover:bg-green-700":"bg-neutral-600 text-neutral-400 cursor-not-allowed"}`,title:x.length>l?`Mensaje demasiado largo (${x.length}/${l})`:v(n)?"Enviar mensaje":`L\xedmite de mensajes alcanzado (${N(n)}/${w(n)})`,children:p?(0,a.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]}),C&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-neutral-700 rounded-lg border border-neutral-600",children:(0,a.jsx)("div",{className:"grid grid-cols-8 gap-2",children:["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0D","\uD83E\uDD14","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDD25","\uD83C\uDF89","\uD83D\uDC4F","\uD83D\uDE22","\uD83D\uDE21","\uD83E\uDD37","\uD83D\uDE4F","\uD83D\uDCAF","✨"].map(e=>(0,a.jsx)("button",{onClick:()=>$(e),className:"text-2xl hover:bg-neutral-600 rounded p-1 transition-colors",children:e},e))})}),(0,a.jsx)("div",{className:"flex items-center justify-between mt-2 text-xs text-neutral-500",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{children:"Enter para enviar"}),(0,a.jsx)("span",{children:"Shift + Enter para nueva l\xednea"}),j&&(0,a.jsxs)("span",{className:"text-green-400 flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-3 h-3 animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("circle",{cx:"12",cy:"12",r:"2"})}),"Escribiendo..."]}),999>w(n)&&(0,a.jsxs)("span",{className:`${2>=b(n)?"text-red-400":"text-neutral-500"}`,children:[N(n),"/",w(n)," mensajes hoy"]})]})})]})]}):(0,a.jsx)("div",{className:"border-t border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsx)("div",{className:"flex items-center justify-center text-neutral-400",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("svg",{className:"w-8 h-8 mx-auto mb-2 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{className:"text-sm",children:"Selecciona una conversaci\xf3n para enviar mensajes"})]})})})}var h=t(53566),p=t(35047);function g(){let{token:e}=(0,n.a)(),{refreshInbox:s}=(0,l.p)(),t=(0,p.useSearchParams)().get("contact"),[m,u]=(0,i.useState)("whatsapp"),[g,j]=(0,i.useState)(null),[f,v]=(0,i.useState)(""),{data:b,mutate:N,isLoading:w}=(0,r.ZP)(e?["/integrations/conversations",m]:null,async([s,t])=>{let a,r;"telegram"===t?(a="/telegram/chats",r="chats"):(a=`${s}?provider=${t}`,r="conversations");let n=await fetch(`https://nexly-production.up.railway.app${a}`,{headers:{Authorization:`Bearer ${e}`}}),l=await n.json();return l[r]?l.conversations=l[r].map(e=>{let s=e.contactName||e.title||e.name;return"telegram"!==t||s||(s=e.username||e.firstName||e.lastName||"Usuario Desconocido"),s||(s="Sin nombre"),{id:String(e.id),title:s,last:e.lastMessage||e.last||"\xdaltimo mensaje no disponible",at:e.lastMessageTime||e.at||new Date().toISOString(),unread:e.unreadCount>0,platform:e.provider||t,avatar:e.avatar,chatType:e.chatType,telegramUsername:e.telegramUsername,contactPhone:e.contactPhone}}):l.conversations=[],l},{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:1e4}),y=b?.conversations||[],{data:k,isLoading:C}=(0,r.ZP)(t&&e?`/contacts/${t}`:null,async s=>{let t=await fetch(`https://nexly-production.up.railway.app${s}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Contact not found");return t.json()});async function M(s){if(e&&g)try{let t;t="telegram"===m?"/telegram/send-message":`/integrations/conversations/${g}/reply`;let a=await fetch(`https://nexly-production.up.railway.app${t}`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({message:s,..."telegram"===m&&{chatId:g}})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.message||`Error ${a.status}: ${a.statusText}`)}await N(),await new Promise(e=>setTimeout(e,200)),window.dispatchEvent(new CustomEvent("messageSent",{detail:{threadId:g}}))}catch(e){throw console.error("Error enviando mensaje:",e),e}}return(0,a.jsxs)("div",{className:"h-full flex flex-col bg-accent-dark text-accent-cream",children:[(0,a.jsxs)("div",{className:"border-b border-neutral-700 bg-neutral-800 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 sm:p-4",children:[(0,a.jsx)("div",{className:"flex gap-1 sm:gap-2 overflow-x-auto",children:h.pD.map(e=>(0,a.jsxs)("button",{onClick:()=>u(e),disabled:w,className:`px-2 sm:px-4 py-1 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors capitalize flex items-center gap-1 sm:gap-2 whitespace-nowrap ${m===e?"bg-green-600 text-accent-cream shadow-lg":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"} ${w?"opacity-50 cursor-not-allowed":""}`,children:[w&&m===e&&(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 sm:h-4 sm:w-4 border-b-2 border-white"}),e]},e))}),(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-neutral-400",children:[t&&C&&(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-blue-400",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"}),"Cargando contacto..."]}),t&&k&&(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-green-400",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),k.name||k.phone||"Contacto seleccionado"]}),(0,a.jsxs)("span",{className:"whitespace-nowrap",children:[b?.conversations?.length||0," conv."]})]})]}),(0,a.jsx)("div",{className:"px-2 sm:px-4 pb-2 sm:pb-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:`Buscar en ${m}...`,value:f,onChange:e=>v(e.target.value),className:"w-full bg-neutral-700 border border-neutral-600 rounded-lg px-3 sm:px-4 py-2 pl-8 sm:pl-10 text-accent-cream placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"}),(0,a.jsx)("div",{className:"absolute left-2 sm:left-3 top-2.5 text-neutral-400",children:(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})})]}),(0,a.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(0,a.jsx)("div",{className:`${g?"hidden lg:flex":"flex"} w-full lg:w-80 border-r border-neutral-700 bg-neutral-800 flex-col h-screen overflow-hidden`,children:(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:w?(0,a.jsx)("div",{className:"p-4 space-y-2",children:Array.from({length:8}).map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3",children:[(0,a.jsx)(c.O,{className:"h-12 w-12 rounded-full flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(c.O,{className:"h-4 w-24"}),(0,a.jsx)(c.O,{className:"h-3 w-12"})]}),(0,a.jsx)(c.O,{className:"h-3 w-32"})]})]},s))}):(0,a.jsx)(o,{items:y,activeId:g,onSelect:j,searchQuery:f})})}),(0,a.jsxs)("div",{className:`${g?"flex":"hidden lg:flex"} flex-1 flex-col h-screen overflow-hidden`,children:[g&&(0,a.jsx)("div",{className:"lg:hidden border-b border-neutral-700 bg-neutral-800 p-2",children:(0,a.jsxs)("button",{onClick:()=>j(null),className:"flex items-center gap-2 text-sm text-neutral-300 hover:text-accent-cream transition-colors",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Volver a conversaciones"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:w?(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-accent-dark",children:[(0,a.jsx)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(c.O,{className:"h-10 w-10 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-32"}),(0,a.jsx)(c.O,{className:"h-3 w-20"})]}),(0,a.jsx)(c.O,{className:"h-6 w-6 rounded"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:Array.from({length:6}).map((e,s)=>(0,a.jsx)("div",{className:s%2==0?"flex justify-start":"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.O,{className:"h-4 w-32"}),(0,a.jsx)(c.O,{className:"h-3 w-16"})]})},s))})]}):(0,a.jsx)(d,{threadId:g,token:e||"",channel:m})}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(x,{threadId:g,token:e||"",onSend:M,channel:m})})]})]})]})}},38227:(e,s,t)=>{"use strict";t.d(s,{O:()=>n});var a=t(68819),r=t(41135);function n({className:e,...s}){return(0,a.jsx)("div",{className:(0,r.Z)("animate-pulse rounded-md bg-neutral-700",e),...s})}},99890:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(17266),r=t(58838);function n(){let e=(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/integrations"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/contacts"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/inbox"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/messages"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/conversations"===e[0])},[]),s=(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/integrations"===e[0])},[]),t=(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/contacts"===e[0])},[]);return{refreshAll:e,refreshIntegrations:s,refreshContacts:t,refreshInbox:(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/inbox"===e[0])},[]),refreshMessages:(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/messages"===e[0])},[]),refreshConversations:(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/conversations"===e[0])},[])}}},53566:(e,s,t)=>{"use strict";t.d(s,{Du:()=>r,pD:()=>a});let a=["whatsapp","instagram","messenger","telegram"],r=[{id:"whatsapp",label:"WhatsApp",color:"bg-green-500",description:"Conecta tu cuenta de WhatsApp Business para enviar y recibir mensajes."},{id:"instagram",label:"Instagram",color:"bg-gradient-to-r from-purple-500 to-pink-500",description:"Conecta tu cuenta de Instagram para gestionar mensajes directos."},{id:"messenger",label:"Facebook Messenger",color:"bg-blue-500",description:"Conecta Facebook Messenger para gestionar conversaciones."},{id:"tiktok",label:"TikTok",color:"bg-black",description:"Conecta TikTok para gestionar mensajes y comentarios."},{id:"telegram",label:"Telegram",color:"bg-blue-500",description:"Conecta tu cuenta personal de Telegram para gestionar todos tus chats y mensajes."}]},55527:(e,s,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.r(s),t.d(s,{default:()=>e});var r=t(71851);let e=(await (0,r.createProxy)(String.raw`C:\Users\Guido\Desktop\Guido\Nexly\web\src\app\(private)\dashboard\inbox\page.tsx`)).default;a()}catch(e){a(e)}},1)},41135:(e,s,t)=>{"use strict";function a(){for(var e,s,t=0,a="",r=arguments.length;t<r;t++)(e=arguments[t])&&(s=function e(s){var t,a,r="";if("string"==typeof s||"number"==typeof s)r+=s;else if("object"==typeof s){if(Array.isArray(s)){var n=s.length;for(t=0;t<n;t++)s[t]&&(a=e(s[t]))&&(r&&(r+=" "),r+=a)}else for(a in s)s[a]&&(r&&(r+=" "),r+=a)}return r}(e))&&(a&&(a+=" "),a+=s);return a}t.d(s,{W:()=>a,Z:()=>r});let r=a}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[147,426,752,224,838,962,148],()=>t(54045));module.exports=a})();