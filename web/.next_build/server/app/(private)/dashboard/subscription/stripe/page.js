(()=>{var e={};e.id=207,e.ids=[207],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},209:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},79348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},15266:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>d.a,__next_app__:()=>u,pages:()=>l,routeModule:()=>m,tree:()=>o});var t=s(3003),a=s(14293),n=s(66550),d=s.n(n),i=s(86979),c={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(r,c);let o=["",{children:["(private)",{children:["dashboard",{children:["subscription",{children:["stripe",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,24424)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\dashboard\\subscription\\stripe\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,77173)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1338)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,52075,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,37973)),"C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,52075,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],l=["C:\\Users\\Guido\\Desktop\\Guido\\Nexly\\web\\src\\app\\(private)\\dashboard\\subscription\\stripe\\page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(private)/dashboard/subscription/stripe/page",pathname:"/dashboard/subscription/stripe",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},61341:(e,r,s)=>{Promise.resolve().then(s.bind(s,84275))},84275:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>k});var t=s(68819),a=s(17266),n=s(83640),d=s(74131),i=s(40818);function c(){let{user:e}=(0,d.a)(),[r,s]=(0,a.useState)(!1),[t,n]=(0,a.useState)(null);return{loading:r,error:t,handleOpenPortal:async()=>{if(!e){n("Usuario no autenticado");return}s(!0),n(null);try{let r=await fetch("/api/stripe/update-payment-method",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e.id})}),s=await r.json();s.url?window.location.href=s.url:n("No se pudo abrir el portal de pagos.")}catch(e){n("Error de conexi\xf3n al abrir el portal de pagos."),console.error("Error al abrir portal:",e)}finally{s(!1)}},cancelSubscription:async e=>{s(!0),n(null);try{let r=await fetch("/api/stripe/cancel-subscription",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:e})});if(!r.ok){let e=await r.json();throw Error(e.error||"Error al cancelar la suscripci\xf3n")}return await r.json()}catch(e){throw n(e instanceof Error?e.message:"Error al cancelar la suscripci\xf3n"),console.error("Error al cancelar suscripci\xf3n:",e),e}finally{s(!1)}},pauseSubscription:async e=>{s(!0),n(null);try{let r=await fetch("/api/stripe/pause-subscription",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:e})});if(!r.ok){let e=await r.json();throw Error(e.error||"Error al pausar la suscripci\xf3n")}return await r.json()}catch(e){throw n(e instanceof Error?e.message:"Error al pausar la suscripci\xf3n"),console.error("Error al pausar suscripci\xf3n:",e),e}finally{s(!1)}},resumeSubscription:async e=>{s(!0),n(null);try{let r=await fetch("/api/stripe/resume-subscription",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionId:e})});if(!r.ok){let e=await r.json();throw Error(e.error||"Error al reanudar la suscripci\xf3n")}return await r.json()}catch(e){throw n(e instanceof Error?e.message:"Error al reanudar la suscripci\xf3n"),console.error("Error al reanudar suscripci\xf3n:",e),e}finally{s(!1)}},clearError:()=>n(null)}}function o(){let{token:e}=(0,d.a)(),[r,s]=(0,a.useState)([]),[t,n]=(0,a.useState)(!1),[i,c]=(0,a.useState)(null);return{invoices:r,loading:t,error:i,refetch:()=>{e&&(n(!0),c(null),s([]))}}}let l=(e,r="usd")=>new Intl.NumberFormat("es-ES",{style:"currency",currency:r.toUpperCase()}).format(e/100),u=e=>new Date(1e3*e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),m=e=>({draft:"Borrador",open:"Pendiente",paid:"Pagada",void:"Anulada",uncollectible:"No cobrable"})[e]||e,x=e=>({draft:"bg-gray-100 text-gray-800",open:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",void:"bg-red-100 text-red-800",uncollectible:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";function p(){let{invoices:e,loading:r}=o(),s=(0,a.useMemo)(()=>{if(!e||0===e.length)return{totalInvoices:0,totalPaid:0,totalPending:0,averageAmount:0,lastInvoiceDate:null};let r=e.filter(e=>"paid"===e.status),s=e.filter(e=>"open"===e.status),t=r.reduce((e,r)=>e+r.total,0),a=s.reduce((e,r)=>e+r.amount_due,0),n=e.length>0?e.reduce((e,r)=>e+r.total,0)/e.length:0,d=e.sort((e,r)=>r.created-e.created)[0],i=d?new Date(1e3*d.created):null;return{totalInvoices:e.length,totalPaid:t,totalPending:a,averageAmount:n,lastInvoiceDate:i}},[e]);return r?(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg",children:[(0,t.jsx)("div",{className:"p-6 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Estad\xedsticas de facturaci\xf3n"})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-4 bg-background rounded w-16 mb-2"}),(0,t.jsx)("div",{className:"h-6 bg-background rounded w-20"})]},e))})})]}):0===s.totalInvoices?null:(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-border",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Estad\xedsticas de facturaci\xf3n"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Resumen de tu actividad de facturaci\xf3n"})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-foreground",children:s.totalInvoices}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total facturas"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-accent-green",children:l(s.totalPaid)}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total pagado"})]}),s.totalPending>0&&(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-accent-cream",children:l(s.totalPending)}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Pendiente"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-accent-blue",children:l(s.averageAmount)}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Promedio"})]})]}),s.lastInvoiceDate&&(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-border",children:(0,t.jsxs)("div",{className:"flex items-center justify-center text-xs text-muted-foreground",children:[(0,t.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"\xdaltima factura: ",s.lastInvoiceDate.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]})})]})]})}function b(){let{subscription:e,loading:r,error:s}=(0,n.mU)(),{user:i}=(0,d.a)(),c=(0,a.useMemo)(()=>{if(!e?.subscription)return"Plan desconocido";switch(e.subscription.planType){case"crecimiento":return"Plan Crecimiento";case"pro":return"Plan Pro";case"business":return"Plan Business";default:return"Plan B\xe1sico"}},[e?.subscription?.planType]),o=(0,a.useMemo)(()=>e?.subscription?({trialing:"Prueba",active:"Activo",incomplete:"Incompleto",incomplete_expired:"Incompleto Expirado",past_due:"Vencido",canceled:"Cancelado",unpaid:"Impago",paused:"Pausado"})[e.subscription.status]||e.subscription.status:"Desconocido",[e?.subscription?.status]),l=(0,a.useMemo)(()=>e?.subscription&&({trialing:"bg-transparent text-accent-blue border border-accent-blue/30",active:"bg-transparent text-accent-green border border-accent-green/30",incomplete:"bg-transparent text-warning border border-warning/30",incomplete_expired:"bg-transparent text-accent-red border border-accent-red/30",past_due:"bg-transparent text-accent-cream border border-accent-cream/30",canceled:"bg-transparent text-accent-red border border-accent-red/30",unpaid:"bg-transparent text-accent-red border border-accent-red/30",paused:"bg-transparent text-muted-foreground border border-border"})[e.subscription.status]||"bg-transparent text-muted-foreground border border-border",[e?.subscription?.status]),u=e=>e?new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"-";return r?(0,t.jsx)("div",{className:"max-w-2xl mx-auto space-y-6",children:(0,t.jsx)("div",{className:"bg-muted border border-border rounded-lg p-6",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,t.jsx)("div",{className:"h-4 bg-background rounded w-1/4"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"h-4 bg-background rounded"}),(0,t.jsx)("div",{className:"h-4 bg-background rounded w-3/4"}),(0,t.jsx)("div",{className:"h-4 bg-background rounded w-1/2"})]})]})})}):s?null:e?.subscription?(0,t.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg",children:[(0,t.jsx)("div",{className:"p-6 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Facturaci\xf3n actual"})}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Estado"}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-md text-xs font-medium ${l}`,children:o})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Plan"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:c})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Monto"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:e?.subscription?(("crecimiento"===e.subscription.planType?2999:4999)/100).toLocaleString("es-ES",{style:"currency",currency:"USD"}):"-"})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Pr\xf3xima factura"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:u(e.subscription.trialEndDate)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"M\xe9todo de pago"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:"M\xe9todo de pago configurado"})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Email cliente"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:i?.email||"-"})]}),(0,t.jsx)("div",{className:"border-t border-border pt-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"ID de suscripci\xf3n"}),(0,t.jsx)("span",{className:"font-mono text-xs text-muted-foreground",children:e.subscription.stripeSubscriptionId||e.subscription.id})]})})]})]}),(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg",children:[(0,t.jsx)("div",{className:"p-6 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Detalles adicionales"})}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Per\xedodo actual"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:u(e.subscription.currentPeriodStart)})]}),e.subscription.trialEndDate&&(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Fin de prueba"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:u(e.subscription.trialEndDate)})]}),e.subscription.isInGracePeriod&&(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Per\xedodo de gracia"}),(0,t.jsxs)("span",{className:"font-medium text-sm text-orange-400",children:[e.subscription.gracePeriodDaysRemaining," d\xedas restantes"]})]}),e.subscription.cancelledAt&&(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Cancelado el"}),(0,t.jsx)("span",{className:"font-medium text-sm text-foreground",children:u(e.subscription.cancelledAt)})]})]})]})]}),(0,t.jsx)(p,{})]}):(0,t.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,t.jsx)("div",{className:"bg-muted border border-border rounded-lg p-6",children:(0,t.jsx)("div",{className:"text-center text-muted-foreground",children:(0,t.jsx)("p",{className:"text-sm",children:"No hay suscripci\xf3n activa"})})})})}function g({className:e=""}){let{invoices:r,loading:s,error:a}=o();return s?(0,t.jsxs)("div",{className:`bg-muted border border-border rounded-lg ${e}`,children:[(0,t.jsx)("div",{className:"p-6 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Historial de facturas"})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-border last:border-b-0",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-background rounded w-32"}),(0,t.jsx)("div",{className:"h-3 bg-background rounded w-24"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-background rounded w-20"}),(0,t.jsx)("div",{className:"h-3 bg-background rounded w-16"})]})]},e))})})]}):a?(0,t.jsxs)("div",{className:`bg-muted border border-border rounded-lg ${e}`,children:[(0,t.jsx)("div",{className:"p-6 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Historial de facturas"})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,t.jsx)("p",{className:"text-sm",children:"Error al cargar las facturas"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a})]})})]}):r&&0!==r.length?(0,t.jsxs)("div",{className:`bg-muted border border-border rounded-lg ${e}`,children:[(0,t.jsxs)("div",{className:"p-6 border-b border-border",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Historial de facturas"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[r.length," factura",1!==r.length?"s":""]})]}),(0,t.jsx)("div",{className:"divide-y divide-border",children:r.map(e=>(0,t.jsx)(h,{invoice:e},e.id))})]}):(0,t.jsxs)("div",{className:`bg-muted border border-border rounded-lg ${e}`,children:[(0,t.jsx)("div",{className:"p-6 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Historial de facturas"})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("svg",{className:"w-12 h-12 mx-auto text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,t.jsx)("p",{className:"text-sm",children:"No hay facturas disponibles"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Las facturas aparecer\xe1n aqu\xed una vez que comiences a usar el servicio"})]})})]})}function h({invoice:e}){return(0,t.jsx)("div",{className:"p-6 hover:bg-muted/50 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.number||`Factura ${e.id.slice(-8)}`}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:u(e.created)})]}),(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${x(e.status)}`,children:m(e.status)})]}),e.description&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Per\xedodo: ",u(e.period_start)," - ",u(e.period_end)]}),e.customer_email&&(0,t.jsxs)("span",{children:["• ",e.customer_email]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-foreground",children:l(e.total,e.currency)}),e.amount_due>0&&e.amount_paid<e.total&&(0,t.jsxs)("p",{className:"text-xs text-accent-cream",children:["Pendiente: ",l(e.amount_due,e.currency)]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[e.hosted_invoice_url&&(0,t.jsxs)("button",{onClick:()=>{e.hosted_invoice_url&&window.open(e.hosted_invoice_url,"_blank")},className:"inline-flex items-center px-2 py-1 border border-border text-xs font-medium rounded-md text-foreground bg-muted hover:bg-muted/80 transition-colors",children:[(0,t.jsxs)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Ver"]}),e.invoice_pdf&&(0,t.jsxs)("button",{onClick:()=>{e.invoice_pdf&&window.open(e.invoice_pdf,"_blank")},className:"inline-flex items-center px-2 py-1 border border-border text-xs font-medium rounded-md text-foreground bg-muted hover:bg-muted/80 transition-colors",children:[(0,t.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"PDF"]})]})]})]})})}function f({subscriptionId:e,status:r,isPaused:s,onStatusChange:n}){let{cancelSubscription:d,pauseSubscription:o,resumeSubscription:l,loading:u,error:m}=c(),{showSuccess:x,showError:p}=(0,i.w)(),[b,g]=(0,a.useState)(null),[h,f]=(0,a.useState)(!1),[j,v]=(0,a.useState)(!1),N=()=>{f(!0)},y=async()=>{f(!1),g("cancel");try{await d(e),x("\xc9xito","trialing"===r?"Per\xedodo de prueba cancelado exitosamente":"Suscripci\xf3n cancelada exitosamente"),n?.()}catch(e){p("Error","Error al cancelar la suscripci\xf3n")}finally{g(null)}},w=async()=>{v(!1),g("pause");try{await o(e),x("\xc9xito","Suscripci\xf3n pausada exitosamente"),n?.()}catch(e){p("Error","Error al pausar la suscripci\xf3n")}finally{g(null)}},k=async()=>{g("resume");try{await l(e),x("\xc9xito","Suscripci\xf3n reanudada exitosamente"),n?.()}catch(e){p("Error","Error al reanudar la suscripci\xf3n")}finally{g(null)}};return m?(0,t.jsx)("div",{className:"bg-accent-red/10 border border-accent-red/20 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-accent-red text-sm",children:m})}):(0,t.jsxs)("div",{className:"space-y-3",children:["active"===r&&!s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>{v(!0)},disabled:u||"pause"===b,className:"w-full px-4 py-2 text-sm font-medium text-accent-cream bg-accent-cream/10 hover:bg-accent-cream/20 disabled:bg-muted rounded-lg transition-colors border border-accent-cream/20",children:"pause"===b?"Pausando...":"Pausar Suscripci\xf3n"}),(0,t.jsx)("button",{onClick:N,disabled:u||"cancel"===b,className:"w-full px-4 py-2 text-sm font-medium text-accent-red bg-accent-red/10 hover:bg-accent-red/20 disabled:bg-muted disabled:text-muted-foreground rounded-lg transition-colors",children:"cancel"===b?"Cancelando...":"Cancelar Suscripci\xf3n"})]}),s&&(0,t.jsx)("button",{onClick:k,disabled:u||"resume"===b,className:"w-full px-4 py-2 text-sm font-medium text-accent-green bg-accent-green/10 hover:bg-accent-green/20 disabled:bg-muted disabled:text-muted-foreground rounded-lg transition-colors",children:"resume"===b?"Reanudando...":"Reanudar Suscripci\xf3n"}),"trialing"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground text-center mb-3",children:[(0,t.jsx)("p",{children:"Tu per\xedodo de prueba est\xe1 activo"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Puedes cancelar en cualquier momento sin costo"})]}),(0,t.jsx)("button",{onClick:N,disabled:u||"cancel"===b,className:"w-full px-4 py-2 text-sm font-medium text-accent-red bg-accent-red/10 hover:bg-accent-red/20 disabled:bg-muted disabled:text-muted-foreground rounded-lg transition-colors",children:"cancel"===b?"Cancelando...":"Cancelar Per\xedodo de Prueba"})]}),"canceled"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground text-center mb-3",children:[(0,t.jsx)("p",{children:"Tu suscripci\xf3n ha sido cancelada"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Puedes reactivar tu suscripci\xf3n en cualquier momento"})]}),(0,t.jsx)("button",{onClick:()=>window.location.href="/pricing",className:"w-full px-4 py-2 text-sm font-medium text-accent-cream bg-nexly-azul hover:bg-nexly-light-blue rounded-lg transition-colors",children:"Reactivar Suscripci\xf3n"}),(0,t.jsx)("button",{onClick:()=>window.location.href="/dashboard/integrations",className:"w-full px-4 py-2 text-sm font-medium text-foreground bg-muted hover:bg-muted/80 rounded-lg transition-colors",children:"Ver Integraciones"})]}),h&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"trialing"===r?"Cancelar Per\xedodo de Prueba":"Cancelar Suscripci\xf3n"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"trialing"===r?"\xbfEst\xe1s seguro de que quieres cancelar tu per\xedodo de prueba? No se te cobrar\xe1 nada y perder\xe1s el acceso inmediatamente.":"\xbfEst\xe1s seguro de que quieres cancelar tu suscripci\xf3n? Esta acci\xf3n no se puede deshacer."}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{onClick:()=>f(!1),className:"px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"Cancelar"}),(0,t.jsx)("button",{onClick:y,disabled:"cancel"===b,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 rounded-lg",children:"cancel"===b?"Cancelando...":"Confirmar"})]})]})}),j&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md mx-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Pausar Suscripci\xf3n"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"\xbfEst\xe1s seguro de que quieres pausar tu suscripci\xf3n? Podr\xe1s reanudarla m\xe1s tarde."}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100",children:"Cancelar"}),(0,t.jsx)("button",{onClick:w,disabled:"pause"===b,className:"px-4 py-2 text-sm font-medium text-white bg-yellow-600 hover:bg-yellow-700 disabled:opacity-50 rounded-lg",children:"pause"===b?"Pausando...":"Confirmar"})]})]})})]})}var j=s(94224);let v={visa:"https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg",mastercard:"https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg",amex:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/American_Express_logo_%282018%29.svg/1200px-American_Express_logo_%282018%29.svg.png",default:"https://cdn-icons-png.flaticon.com/512/179/179457.png"},N=e=>e&&({visa:"visa",mastercard:"mastercard",amex:"amex"})[e.toLowerCase()]||"default",y=e=>e?.status==="active"?"Activa":e?.status==="trialing"?"Prueba Gratuita":e?.status==="paused"?"Pausada":e?.status==="canceled"?"Cancelada":"Desconocida",w=e=>{switch(e){case"active":return"bg-transparent text-accent-green border border-accent-green/30";case"trialing":return"bg-transparent text-accent-blue border border-accent-blue/30";case"paused":return"bg-transparent text-accent-cream border border-accent-cream/30";case"canceled":return"bg-transparent text-accent-red border border-accent-red/30";default:return"bg-transparent text-muted-foreground border border-border"}};function k(){let{subscription:e,loading:r,forceRefresh:s}=(0,n.mU)(),{user:o}=(0,d.a)(),{showSuccess:l,showError:u}=(0,i.w)(),{handleOpenPortal:m,loading:x}=c(),[p,h]=(0,a.useState)(!1),[k,P]=(0,a.useState)(null),[C,E]=(0,a.useState)(!0);if(r||C)return(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)(j.ZP,{size:"lg",text:"Cargando Suscripci\xf3n..."})});let S=e?.hasSubscription;if(console.log("subscription stripe page",e),!S)return(0,t.jsx)("div",{className:"min-h-screen p-6",style:{background:"var(--background-gradient)"},children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg p-8 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-background border border-border rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("span",{className:"text-2xl text-muted-foreground",children:"●"})}),(0,t.jsx)("h2",{className:"text-lg font-medium text-foreground mb-2",children:"Sin Suscripci\xf3n Activa"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm mb-6",children:"No tienes una suscripci\xf3n activa. Elige un plan para comenzar."}),(0,t.jsx)("button",{onClick:()=>{window.location.href="/pricing"},className:"bg-accent-green/20 border border-accent-green/30 text-accent-green hover:bg-accent-green/30 px-6 py-3 rounded-lg font-medium transition-colors",children:"Ver Planes Disponibles"})]})})});let _=e.subscription,D=k?.subscription,M=k?.paymentMethod,T=M?.card||{brand:"visa",last4:"4242"},G=N(T?.brand),I=D?.pauseCollection||_?.status==="paused",L=D?.currentPeriodEnd?new Date(D.currentPeriodEnd).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"Fecha no disponible",A=D?.amount?(D.amount/100).toFixed(2):_?.planType==="crecimiento"?"29.99":_?.planType==="pro"?"59.99":"149.99",q=D?.status||_?.status;return(0,t.jsx)("div",{className:"min-h-screen p-6",style:{background:"var(--background-gradient)"},children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-lg font-medium text-foreground mb-2",children:"Mi Suscripci\xf3n"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"Gestiona tu suscripci\xf3n y m\xe9todo de pago"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-foreground",children:"Estado de Suscripci\xf3n"}),(0,t.jsx)("div",{className:`px-4 py-2 rounded-full border text-sm font-medium ${w(q)}`,children:y({..._,status:q})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"ID de Suscripci\xf3n"}),(0,t.jsx)("p",{className:"text-foreground font-mono text-xs mt-1 bg-background px-3 py-2 rounded-md",children:k?.subscription?.id||e.subscription?.id||"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Plan"}),(0,t.jsx)("p",{className:"text-sm font-semibold text-foreground mt-1 capitalize",children:_?.planType==="crecimiento"?"Crecimiento":_?.planType==="pro"?"Pro":_?.planType==="business"?"Business":"N/A"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Monto"}),(0,t.jsxs)("p",{className:"text-lg font-semibold text-foreground mt-1",children:["$",A,(0,t.jsx)("span",{className:"text-xs font-normal text-muted-foreground ml-1",children:"/mes"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Pr\xf3xima Renovaci\xf3n"}),(0,t.jsx)("p",{className:"text-sm text-foreground mt-1",children:L})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg p-6",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-foreground mb-4",children:"M\xe9todo de Pago"}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-12 h-8 bg-background border border-border rounded flex items-center justify-center",children:(0,t.jsx)("img",{src:v[G]||v.default,alt:G,className:"h-6 w-auto"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium text-sm text-foreground",children:["visa"===G?"Visa":"mastercard"===G?"Mastercard":"amex"===G?"American Express":"Tarjeta"," ","terminada en ",T?.last4||"****"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"M\xe9todo de pago por defecto"})]})]}),(0,t.jsx)("button",{onClick:m,disabled:x,className:"px-3 py-2 text-xs font-medium text-foreground bg-muted hover:bg-muted/80 disabled:bg-muted/50 rounded-md transition-colors border border-border",children:x?"Cargando...":"Cambiar"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg p-6",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-foreground mb-4",children:"Acciones"}),(0,t.jsx)(f,{subscriptionId:_?.stripeSubscriptionId||_?.id||"",status:q,isPaused:I,onStatusChange:()=>{s()}})]}),(0,t.jsxs)("div",{className:"bg-muted border border-border rounded-lg p-6",children:[(0,t.jsx)("h4",{className:"font-medium text-foreground mb-2 text-sm",children:"Informaci\xf3n"}),(0,t.jsxs)("ul",{className:"text-xs text-muted-foreground space-y-2",children:[(0,t.jsx)("li",{children:"• Pausar mantiene tus datos"}),(0,t.jsx)("li",{children:"• Cancelar elimina acceso inmediato"}),(0,t.jsx)("li",{children:"• Puedes reactivar en cualquier momento"}),(0,t.jsx)("li",{children:"• Acceso completo a todas las funciones"})]})]})]}),(0,t.jsx)("div",{className:"lg:col-span-2 mb-8",children:(0,t.jsx)(b,{})}),(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)(g,{})})]})]})})}},40818:(e,r,s)=>{"use strict";s.d(r,{w:()=>a});var t=s(17266);function a(){let{showNotification:e}=function(){let[e,r]=(0,t.useState)([]),s=(0,t.useCallback)(e=>{let s=Math.random().toString(36).substr(2,9),t={id:s,duration:e.duration??5e3,...e};r(e=>[...e,t]),t.duration&&t.duration>0&&setTimeout(()=>{a(s)},t.duration)},[]),a=(0,t.useCallback)(e=>{r(r=>r.filter(r=>r.id!==e))},[]);return{notifications:e,showNotification:s,hideNotification:a,clearAll:(0,t.useCallback)(()=>{r([])},[])}}(),r=(0,t.useCallback)((r,s)=>{e({type:"success",title:r,message:s})},[e]);return{showSuccess:r,showError:(0,t.useCallback)((r,s)=>{e({type:"error",title:r,message:s,duration:0})},[e]),showInfo:(0,t.useCallback)((r,s)=>{e({type:"info",title:r,message:s})},[e]),showWarning:(0,t.useCallback)((r,s)=>{e({type:"warning",title:r,message:s})},[e])}}},24424:(e,r,s)=>{"use strict";s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{default:()=>e});var a=s(71851);let e=(await (0,a.createProxy)(String.raw`C:\Users\Guido\Desktop\Guido\Nexly\web\src\app\(private)\dashboard\subscription\stripe\page.tsx`)).default;t()}catch(e){t(e)}},1)}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[147,426,752,224,962,148],()=>s(15266));module.exports=t})();