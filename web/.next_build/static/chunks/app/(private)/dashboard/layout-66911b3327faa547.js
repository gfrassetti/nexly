(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[619],{26044:(e,t,r)=>{Promise.resolve().then(r.bind(r,66657))},16463:(e,t,r)=>{"use strict";var a=r(71169);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},66657:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(57437),n=r(87138),s=r(16463),l=r(70640);let i=[{id:"resumen",label:"Resumen",href:"/dashboard"},{id:"inbox",label:"Inbox",href:"/dashboard/inbox"},{id:"contacts",label:"Contactos",href:"/dashboard/contacts"},{id:"integrations",label:"Integraciones",href:"/dashboard/integrations"},{id:"subscription",label:"Mi Suscripci\xf3n",href:"/dashboard/subscription"}];function c(){let e=(0,s.usePathname)();return(0,a.jsxs)("aside",{className:"h-screen sticky top-0 border-r border-neutral-800 p-4 flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"px-2 py-2",children:(0,a.jsx)(l.Z,{size:"md",className:"h-[4rem]"})}),i.map(t=>(0,a.jsx)(n.default,{href:t.href,className:"w-full text-left px-4 py-2 rounded-lg transition ".concat(e===t.href?"bg-neutral-700":"hover:bg-neutral-800"),children:t.label},t.id))]})}var o=r(67048),d=r(12104),u=r(2265);let p=[{id:"resumen",label:"Resumen",href:"/dashboard"},{id:"inbox",label:"Inbox",href:"/dashboard/inbox"},{id:"contacts",label:"Contactos",href:"/dashboard/contacts"},{id:"integrations",label:"Integraciones",href:"/dashboard/integrations"},{id:"subscription",label:"Mi Suscripci\xf3n",href:"/dashboard/subscription"}];function m(){let{user:e,logout:t}=(0,o.a)(),{subscription:r,status:l}=(0,d.mU)();(0,s.useRouter)();let i=(0,s.usePathname)(),[c,m]=(0,u.useState)(!1),h=()=>{if(!(null==r?void 0:r.subscription))return null;let e=r.subscription,t=e.status,n="",s="";return e.stripeSubscriptionId?(n="crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business",s="pro"===e.planType?"bg-accent-dark text-accent-cream border border-accent-dark/30":"business"===e.planType?"bg-purple-600 text-white border border-purple-600/30":"text-accent-green border border-accent-green/30"):"trialing"===t?(n="".concat("crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business"," Trial"),s="pro"===e.planType?"bg-accent-dark text-accent-cream border border-accent-dark/30":"business"===e.planType?"bg-purple-600 text-white border border-purple-600/30":"text-accent-blue border border-accent-blue/30"):"active"===t?(n="crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business",s="pro"===e.planType?"bg-accent-dark text-accent-cream border border-accent-dark/30":"business"===e.planType?"bg-purple-600 text-white border border-purple-600/30":"text-accent-green border border-accent-green/30"):"paused"===t?(n="".concat("crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business"," (Pausado)"),s="pro"===e.planType?"bg-accent-dark text-accent-cream border border-accent-dark/30":"business"===e.planType?"bg-purple-600 text-white border border-purple-600/30":"text-accent-cream border border-accent-cream/30"):"past_due"===t||"unpaid"===t?(n="".concat("crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business"," (Gracia)"),s="pro"===e.planType?"bg-accent-dark text-accent-cream border border-accent-dark/30":"business"===e.planType?"bg-purple-600 text-white border border-purple-600/30":"text-warning border border-warning/30"):(n="canceled"===t?"".concat("crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business"," (Cancelado)"):"crecimiento"===e.planType?"Crecimiento":"pro"===e.planType?"Pro":"Business",s="pro"===e.planType?"bg-accent-dark text-accent-cream border border-accent-dark/30":"business"===e.planType?"bg-purple-600 text-white border border-purple-600/30":"text-muted-foreground border border-border"),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-transparent ".concat(s),children:n})},b=()=>{if(!(null==r?void 0:r.subscription))return null;let e=r.subscription;if(!(e.trialEndDate&&new Date(e.trialEndDate)>new Date))return null;let t=new Date(e.trialEndDate),n=new Date,s=Math.max(0,Math.ceil((t.getTime()-n.getTime())/864e5)),l=new Date(t.getTime()-6048e5),i=Math.min(Math.max(0,Math.ceil((n.getTime()-l.getTime())/864e5))/7*100,100);return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-16 h-1 bg-neutral-700 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-accent-blue transition-all duration-300",style:{width:"".concat(Math.min(i,100),"%")}})}),(0,a.jsxs)("span",{className:"text-xs text-neutral-400",children:[s,"d restantes"]})]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("header",{className:"h-12 flex items-center justify-between px-4 bg-accent-dark border-b border-neutral-700",children:[(0,a.jsx)("button",{onClick:()=>m(!c),className:"lg:hidden p-2 rounded-md hover:bg-neutral-800 transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-neutral-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,a.jsx)("div",{className:"hidden lg:block text-sm text-neutral-300",children:"Panel"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"hidden sm:block text-sm text-neutral-300",children:["Hola, ",e.username]}),(0,a.jsxs)("div",{className:"hidden md:flex items-center gap-2",children:[h(),b()]})]}),(0,a.jsxs)("button",{onClick:()=>{t()},className:"px-2 sm:px-3 py-1 rounded bg-neutral-800 hover:bg-neutral-700 text-xs sm:text-sm transition-colors duration-200",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Salir"}),(0,a.jsx)("svg",{className:"w-4 h-4 sm:hidden",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})]})]})]}),c&&(0,a.jsx)("div",{className:"lg:hidden bg-neutral-800 border-b border-neutral-700",children:(0,a.jsxs)("nav",{className:"px-4 py-2 space-y-1",children:[p.map(e=>(0,a.jsx)(n.default,{href:e.href,onClick:()=>m(!1),className:"block px-3 py-2 rounded-lg text-sm transition-colors ".concat(i===e.href?"bg-neutral-700 text-accent-cream":"text-neutral-300 hover:bg-neutral-700"),children:e.label},e.id)),e&&(0,a.jsxs)("div",{className:"px-3 py-2 border-t border-neutral-700 mt-2 pt-2",children:[(0,a.jsxs)("div",{className:"text-xs text-neutral-400 mb-2",children:["Hola, ",e.username]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[h(),b()]})]})]})})]})}var h=r(53508);class b extends u.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){return this.state.hasError?this.props.fallback||(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-accent-dark",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("span",{className:"text-2xl text-red-600",children:"⚠️"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-accent-cream mb-2",children:"Algo sali\xf3 mal"}),(0,a.jsx)("p",{className:"text-gray-400 mb-4",children:"Se ha producido un error inesperado"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-nexly-teal hover:bg-nexly-green text-accent-cream font-semibold px-6 py-3 rounded-lg transition-colors duration-300",children:"Recargar p\xe1gina"})]})}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}function x(e){let{children:t}=e;return(0,a.jsx)(h.default,{requireAuth:!0,children:(0,a.jsx)(d.qR,{children:(0,a.jsx)(b,{children:(0,a.jsxs)("div",{className:"min-h-screen flex flex-col lg:grid lg:grid-cols-[260px_1fr] bg-accent-dark text-neutral-100",children:[(0,a.jsx)("div",{className:"hidden lg:block",children:(0,a.jsx)(c,{})}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 lg:col-start-2",children:[(0,a.jsx)(m,{}),(0,a.jsx)("main",{className:"flex-1 overflow-auto p-2 sm:p-4",children:t})]})]})})})})}},53508:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var a=r(57437),n=r(2265),s=r(16463),l=r(67048),i=r(61575);function c(e){let{children:t,requireAuth:r=!0}=e,c=(0,s.useRouter)(),{token:o,user:d,clear:u,isLoading:p}=(0,l.a)(),m=!!(o&&d);return((0,n.useEffect)(()=>{if(!p){if(r&&!m){console.log("\uD83D\uDEE1️ AuthGuard - Redirigiendo a login (requiere auth pero no est\xe1 autenticado)"),c.replace("/login");return}if(!r&&m){console.log("\uD83D\uDEE1️ AuthGuard - Redirigiendo a dashboard (est\xe1 autenticado pero en p\xe1gina de auth)"),c.replace("/dashboard");return}console.log("\uD83D\uDEE1️ AuthGuard - Permitiendo acceso")}},[m,p,r,c]),p)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-accent-dark",children:(0,a.jsx)(i.ZP,{size:"lg",text:"Verificando autenticaci\xf3n..."})}):r&&!m||!r&&m?null:(0,a.jsx)(a.Fragment,{children:t})}},61575:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>s});var a=r(57437),n=r(66648);function s(e){let{size:t="md",text:r,fullScreen:s=!1,className:l=""}=e,i={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"},c={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"},o={sm:"border-2",md:"border-[3px]",lg:"border-4",xl:"border-[5px]"},d=()=>(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 ".concat(l),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"\n            ".concat(i[t]," \n            ").concat(o[t],"\n            rounded-full \n            border-transparent\n            border-t-nexly-green \n            border-r-nexly-teal\n            animate-spin\n            shadow-nexly-green/30\n          "),style:{animationDuration:"1s",animationTimingFunction:"linear"}}),(0,a.jsx)("div",{className:"\n          ".concat(i[t]," \n          rounded-full \n          absolute top-0 left-0 \n          flex items-center justify-center\n          bg-gradient-to-br from-nexly-green/10 to-nexly-teal/10\n        "),children:(0,a.jsx)(n.default,{src:"/logo_single.png",alt:"Nexly",width:48,height:48,className:"".concat(c[t]," object-contain animate-pulse"),priority:!0})})]}),r&&(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-accent-cream font-medium text-sm tracking-wide mb-2",children:r}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-green rounded-full animate-bounce shadow-lg shadow-nexly-green/50"}),(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-teal rounded-full animate-bounce shadow-lg shadow-nexly-teal/50",style:{animationDelay:"0.15s"}}),(0,a.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-green rounded-full animate-bounce shadow-lg shadow-nexly-green/50",style:{animationDelay:"0.3s"}})]})]})]});return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,a.jsx)(d,{})}):(0,a.jsx)(d,{})}},70640:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var a=r(57437),n=r(87138);function s(e){let{href:t="/",className:r="",showText:s=!1,textClassName:l="text-xl font-bold",size:i="md"}=e,c=(0,a.jsxs)("div",{className:"flex items-center gap-3 ".concat(r),children:[(0,a.jsx)("div",{className:"".concat({sm:"w-24",md:"w-32",lg:"w-40"}[i]," flex items-center justify-center"),children:(0,a.jsx)("img",{src:"/logo_nexly.png",alt:"Nexly Logo",className:"w-full h-full object-contain"})}),s&&(0,a.jsx)("span",{className:"".concat(l),children:"Nexly"})]});return t?(0,a.jsx)(n.default,{href:t,className:"inline-block hover:opacity-80 transition-opacity duration-300",children:c}):c}},12104:(e,t,r)=>{"use strict";r.d(t,{f4:()=>o,mU:()=>c,qR:()=>i});var a=r(57437),n=r(2265),s=r(67048);let l=(0,n.createContext)(void 0);function i(e){let{children:t}=e,{token:r}=(0,s.a)(),[i,c]=(0,n.useState)(null),[o,d]=(0,n.useState)(!0),[u,p]=(0,n.useState)(null),m=(0,n.useCallback)(async()=>{if(!r){d(!1);return}try{var e;d(!0),p(null),console.log("\uD83D\uDD04 Fetching subscription status...");let t=await fetch("".concat("https://nexly-production.up.railway.app","/subscriptions/status?t=").concat(Date.now()),{headers:{Authorization:"Bearer ".concat(r),"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Error ".concat(t.status,": ").concat(t.statusText));let a=await t.json();console.log("\uD83D\uDCCA Subscription data received:",a),c(a),a.hasSubscription&&(null===(e=a.subscription)||void 0===e?void 0:e.planType)?(localStorage.setItem("selectedPlan",a.subscription.planType),localStorage.setItem("hasActiveSubscription","true")):(localStorage.removeItem("selectedPlan"),localStorage.removeItem("hasActiveSubscription"))}catch(e){console.error("❌ Error fetching subscription:",e),c({hasSubscription:!1}),p(e instanceof Error?e.message:"Error desconocido"),localStorage.removeItem("hasActiveSubscription")}finally{d(!1)}},[r]);(0,n.useEffect)(()=>{c(null),p(null),d(!0),r?m():d(!1)},[r,m]);let h=(0,n.useMemo)(()=>{var e;if(!i)return{isPaid:!1,isTrial:!1,isFree:!0,active:!1,trialActive:!1,pendingPaymentMethod:!1,paused:!1,cancelled:!1,pastDue:!1,incomplete:!1};let t=i.hasSubscription,r=i.userSubscriptionStatus,a=null===(e=i.subscription)||void 0===e?void 0:e.status,n="active_paid"===r||"active"===a,s="active_trial"===r||"trialing"===a;return{isPaid:!!n,isTrial:!!s,isFree:!(n||s)||!t,active:!!n,trialActive:!!s,pendingPaymentMethod:"trial_pending_payment_method"===r,paused:"paused"===a,cancelled:"canceled"===a,pastDue:"past_due"===a,incomplete:!!("incomplete"===a||"incomplete_expired"===a)}},[i]),b=(0,n.useCallback)(e=>{var t,r;if(!(null==i?void 0:i.hasSubscription))return!1;let a=null===(t=i.subscription)||void 0===t?void 0:t.planType;return!!a&&((null===(r=({crecimiento:["whatsapp","instagram","telegram"],pro:["whatsapp","instagram","messenger","telegram"],business:["whatsapp","instagram","messenger","telegram","tiktok","twitter"]})[a])||void 0===r?void 0:r.includes(e))||!1)},[i]),x=(0,n.useCallback)(()=>{var e;if(!(null==i?void 0:i.hasSubscription))return 0;switch(null===(e=i.subscription)||void 0===e?void 0:e.planType){case"crecimiento":return 3;case"pro":return 4;case"business":return 999;default:return 0}},[i]),g=(0,n.useCallback)(e=>{var t;c(e),p(null),e.hasSubscription&&(null===(t=e.subscription)||void 0===t?void 0:t.planType)&&(localStorage.setItem("selectedPlan",e.subscription.planType),localStorage.setItem("hasActiveSubscription","true"))},[]),f=(0,n.useCallback)(async()=>{console.log("\uD83D\uDD04 Forcing subscription context refresh..."),await m()},[m]),v=(0,n.useMemo)(()=>({subscription:i,loading:o,error:u,status:h,refetch:m,canUseFeature:b,getMaxIntegrations:x,updateAfterPayment:g,forceRefresh:f}),[i,o,u,h,m,b,x,g,f]);return(0,a.jsx)(l.Provider,{value:v,children:t})}function c(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}function o(){return(0,n.useContext)(l)}},67048:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var a=r(2265);function n(){let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(null),[s,l]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(e&&r)try{let a=JSON.parse(r);n(e),t(a)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}l(!1)},[]),{user:e,token:r,setAuth:(e,r)=>{n(e),t(r),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(r))},clear:()=>{n(null),t(null),localStorage.removeItem("token"),localStorage.removeItem("user")},logout:()=>{console.log("\uD83D\uDD04 Logout manual iniciado..."),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),window.location.replace("/login")},isLoading:s,isAuthenticated:!!r&&!!e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[7138,6648,7130,6215,1744],()=>t(26044)),_N_E=e.O()}]);