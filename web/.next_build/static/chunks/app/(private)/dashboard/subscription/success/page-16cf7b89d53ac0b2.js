(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7330],{13032:(e,t,a)=>{Promise.resolve().then(a.bind(a,72381))},16463:(e,t,a)=>{"use strict";var s=a(71169);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},72381:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m,dynamic:()=>u});var s=a(57437),r=a(2265),n=a(16463),l=a(67048),i=a(12104),c=a(70640),o=a(61575);let u="force-dynamic";function d(){let e=(0,n.useRouter)();(0,n.useSearchParams)();let{token:t,user:a}=(0,l.a)(),{refetch:u,updateAfterPayment:d}=(0,i.mU)(),[m,x]=(0,r.useState)(!0),[h,p]=(0,r.useState)("loading"),[g,b]=(0,r.useState)("");return((0,r.useEffect)(()=>{(async()=>{if(!t){e.push("/login");return}try{await u(),setTimeout(()=>{p("success"),b("\xa1Tu prueba gratuita ha sido activada exitosamente!"),setTimeout(()=>{e.push("/dashboard?trial_started=true")},2e3)},1e3)}catch(t){console.error("Error processing payment:",t),p("error"),b("Hubo un error al procesar tu pago. Por favor, intenta de nuevo."),setTimeout(()=>{e.push("/dashboard")},3e3)}finally{x(!1)}})()},[t,e,u]),m)?(0,s.jsx)("div",{className:"min-h-screen bg-accent-dark text-accent-cream flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)(c.Z,{size:"lg"})}),(0,s.jsx)(o.ZP,{size:"lg"}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Procesando tu pago..."}),(0,s.jsx)("p",{className:"text-neutral-400",children:"Por favor espera mientras activamos tu prueba gratuita"})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-accent-dark text-accent-cream flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)(c.Z,{size:"lg"})}),"success"===h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-accent-cream",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-green-400 mb-4",children:"\xa1Pago Exitoso!"}),(0,s.jsx)("p",{className:"text-neutral-300 mb-6",children:g}),(0,s.jsxs)("div",{className:"bg-green-900/20 border border-green-700 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"text-green-400 font-semibold mb-2",children:"Tu prueba gratuita est\xe1 activa"}),(0,s.jsx)("p",{className:"text-green-300 text-sm",children:"Ahora puedes acceder a todas las funciones de Nexly durante 7 d\xedas"})]}),(0,s.jsx)("p",{className:"text-neutral-400 text-sm",children:"Redirigiendo al dashboard..."})]}),"error"===h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-accent-cream",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"Error en el Pago"}),(0,s.jsx)("p",{className:"text-neutral-300 mb-6",children:g}),(0,s.jsxs)("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h3",{className:"text-red-400 font-semibold mb-2",children:"\xbfNecesitas ayuda?"}),(0,s.jsx)("p",{className:"text-red-300 text-sm",children:"Verifica tu m\xe9todo de pago e intenta nuevamente"})]}),(0,s.jsx)("p",{className:"text-neutral-400 text-sm",children:"Redirigiendo al dashboard..."})]})]})})}function m(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-accent-dark text-accent-cream flex items-center justify-center",children:(0,s.jsx)(o.ZP,{size:"lg"})}),children:(0,s.jsx)(d,{})})}},61575:(e,t,a)=>{"use strict";a.d(t,{ZP:()=>n});var s=a(57437),r=a(66648);function n(e){let{size:t="md",text:a,fullScreen:n=!1,className:l=""}=e,i={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"},c={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"},o={sm:"border-2",md:"border-[3px]",lg:"border-4",xl:"border-[5px]"},u=()=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 ".concat(l),children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"\n            ".concat(i[t]," \n            ").concat(o[t],"\n            rounded-full \n            border-transparent\n            border-t-nexly-green \n            border-r-nexly-teal\n            animate-spin\n            shadow-nexly-green/30\n          "),style:{animationDuration:"1s",animationTimingFunction:"linear"}}),(0,s.jsx)("div",{className:"\n          ".concat(i[t]," \n          rounded-full \n          absolute top-0 left-0 \n          flex items-center justify-center\n          bg-gradient-to-br from-nexly-green/10 to-nexly-teal/10\n        "),children:(0,s.jsx)(r.default,{src:"/logo_single.png",alt:"Nexly",width:48,height:48,className:"".concat(c[t]," object-contain animate-pulse"),priority:!0})})]}),a&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-accent-cream font-medium text-sm tracking-wide mb-2",children:a}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-green rounded-full animate-bounce shadow-lg shadow-nexly-green/50"}),(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-teal rounded-full animate-bounce shadow-lg shadow-nexly-teal/50",style:{animationDelay:"0.15s"}}),(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-green rounded-full animate-bounce shadow-lg shadow-nexly-green/50",style:{animationDelay:"0.3s"}})]})]})]});return n?(0,s.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,s.jsx)(u,{})}):(0,s.jsx)(u,{})}},70640:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var s=a(57437),r=a(87138);function n(e){let{href:t="/",className:a="",showText:n=!1,textClassName:l="text-xl font-bold",size:i="md"}=e,c=(0,s.jsxs)("div",{className:"flex items-center gap-3 ".concat(a),children:[(0,s.jsx)("div",{className:"".concat({sm:"w-24",md:"w-32",lg:"w-40"}[i]," flex items-center justify-center"),children:(0,s.jsx)("img",{src:"/logo_nexly.png",alt:"Nexly Logo",className:"w-full h-full object-contain"})}),n&&(0,s.jsx)("span",{className:"".concat(l),children:"Nexly"})]});return t?(0,s.jsx)(r.default,{href:t,className:"inline-block hover:opacity-80 transition-opacity duration-300",children:c}):c}},12104:(e,t,a)=>{"use strict";a.d(t,{f4:()=>o,mU:()=>c,qR:()=>i});var s=a(57437),r=a(2265),n=a(67048);let l=(0,r.createContext)(void 0);function i(e){let{children:t}=e,{token:a}=(0,n.a)(),[i,c]=(0,r.useState)(null),[o,u]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),x=(0,r.useCallback)(async()=>{if(!a){u(!1);return}try{var e;u(!0),m(null),console.log("\uD83D\uDD04 Fetching subscription status...");let t=await fetch("".concat("https://nexly-production.up.railway.app","/subscriptions/status?t=").concat(Date.now()),{headers:{Authorization:"Bearer ".concat(a),"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Error ".concat(t.status,": ").concat(t.statusText));let s=await t.json();console.log("\uD83D\uDCCA Subscription data received:",s),c(s),s.hasSubscription&&(null===(e=s.subscription)||void 0===e?void 0:e.planType)?(localStorage.setItem("selectedPlan",s.subscription.planType),localStorage.setItem("hasActiveSubscription","true")):(localStorage.removeItem("selectedPlan"),localStorage.removeItem("hasActiveSubscription"))}catch(e){console.error("❌ Error fetching subscription:",e),c({hasSubscription:!1}),m(e instanceof Error?e.message:"Error desconocido"),localStorage.removeItem("hasActiveSubscription")}finally{u(!1)}},[a]);(0,r.useEffect)(()=>{c(null),m(null),u(!0),a?x():u(!1)},[a,x]);let h=(0,r.useMemo)(()=>{var e;if(!i)return{isPaid:!1,isTrial:!1,isFree:!0,active:!1,trialActive:!1,pendingPaymentMethod:!1,paused:!1,cancelled:!1,pastDue:!1,incomplete:!1};let t=i.hasSubscription,a=i.userSubscriptionStatus,s=null===(e=i.subscription)||void 0===e?void 0:e.status,r="active_paid"===a||"active"===s,n="active_trial"===a||"trialing"===s;return{isPaid:!!r,isTrial:!!n,isFree:!(r||n)||!t,active:!!r,trialActive:!!n,pendingPaymentMethod:"trial_pending_payment_method"===a,paused:"paused"===s,cancelled:"canceled"===s,pastDue:"past_due"===s,incomplete:!!("incomplete"===s||"incomplete_expired"===s)}},[i]),p=(0,r.useCallback)(e=>{var t,a;if(!(null==i?void 0:i.hasSubscription))return!1;let s=null===(t=i.subscription)||void 0===t?void 0:t.planType;return!!s&&((null===(a=({crecimiento:["whatsapp","instagram","telegram"],pro:["whatsapp","instagram","messenger","telegram"],business:["whatsapp","instagram","messenger","telegram","tiktok","twitter"]})[s])||void 0===a?void 0:a.includes(e))||!1)},[i]),g=(0,r.useCallback)(()=>{var e;if(!(null==i?void 0:i.hasSubscription))return 0;switch(null===(e=i.subscription)||void 0===e?void 0:e.planType){case"crecimiento":return 3;case"pro":return 4;case"business":return 999;default:return 0}},[i]),b=(0,r.useCallback)(e=>{var t;c(e),m(null),e.hasSubscription&&(null===(t=e.subscription)||void 0===t?void 0:t.planType)&&(localStorage.setItem("selectedPlan",e.subscription.planType),localStorage.setItem("hasActiveSubscription","true"))},[]),f=(0,r.useCallback)(async()=>{console.log("\uD83D\uDD04 Forcing subscription context refresh..."),await x()},[x]),v=(0,r.useMemo)(()=>({subscription:i,loading:o,error:d,status:h,refetch:x,canUseFeature:p,getMaxIntegrations:g,updateAfterPayment:b,forceRefresh:f}),[i,o,d,h,x,p,g,b,f]);return(0,s.jsx)(l.Provider,{value:v,children:t})}function c(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}function o(){return(0,r.useContext)(l)}},67048:(e,t,a)=>{"use strict";a.d(t,{a:()=>r});var s=a(2265);function r(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),[n,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=localStorage.getItem("token"),a=localStorage.getItem("user");if(e&&a)try{let s=JSON.parse(a);r(e),t(s)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}l(!1)},[]),{user:e,token:a,setAuth:(e,a)=>{r(e),t(a),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(a))},clear:()=>{r(null),t(null),localStorage.removeItem("token"),localStorage.removeItem("user")},logout:()=>{console.log("\uD83D\uDD04 Logout manual iniciado..."),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),window.location.replace("/login")},isLoading:n,isAuthenticated:!!a&&!!e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[7138,6648,7130,6215,1744],()=>t(13032)),_N_E=e.O()}]);