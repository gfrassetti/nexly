(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1841],{7030:(e,t,r)=>{Promise.resolve().then(r.bind(r,17460))},16463:(e,t,r)=>{"use strict";var n=r(71169);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},77616:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return a}});let n=r(2265);function a(e,t){let r=(0,n.useRef)(()=>{}),a=(0,n.useRef)(()=>{});return(0,n.useMemo)(()=>e&&t?n=>{null===n?(r.current(),a.current()):(r.current=l(e,n),a.current=l(t,n))}:e||t,[e,t])}function l(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},60291:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return n}});let n=r(99920)._(r(2265)).default.createContext(null)},17460:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(57437),a=r(12104),l=r(67048),s=r(2265),o=r(61575),i=r(16463);function c(){let{subscription:e,loading:t}=(0,a.mU)(),{user:r}=(0,l.a)(),c=(0,i.useRouter)();return(!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{enabled:t=!0,pollingInterval:r=2e3,maxRetries:n=10}=e,{subscription:l,forceRefresh:o,updateAfterPayment:i}=(0,a.mU)(),c=(0,s.useRef)(0),u=(0,s.useRef)(null),d=(0,s.useRef)(!1),m=(0,s.useCallback)(async e=>{!d.current&&(console.log("\uD83D\uDCB3 Payment success detected, updating context immediately"),d.current=!0,i(e),u.current&&(clearInterval(u.current),u.current=null))},[i]),p=(0,s.useCallback)(async()=>{if(c.current>=n){console.log("⏹️ Max retries reached, stopping polling"),u.current&&(clearInterval(u.current),u.current=null);return}try{await o(),c.current++,(null==l?void 0:l.hasSubscription)&&!d.current&&(console.log("✅ Subscription active detected, stopping polling"),u.current&&(clearInterval(u.current),u.current=null))}catch(e){console.error("❌ Error during polling:",e)}},[n,o,null==l?void 0:l.hasSubscription]);(0,s.useEffect)(()=>{if(!t)return;console.log("\uD83D\uDD04 Starting payment update polling..."),p(),u.current=setInterval(p,r);let e=e=>{var t,r;(null===(t=e.data)||void 0===t?void 0:t.type)==="payment_completed"&&(null===(r=e.data)||void 0===r?void 0:r.subscriptionData)&&m(e.data.subscriptionData)},n=()=>{d.current||(null==l?void 0:l.hasSubscription)||(console.log("\uD83D\uDC41️ Window focused, checking for updates..."),p())};return window.addEventListener("message",e),window.addEventListener("focus",n),()=>{u.current&&clearInterval(u.current),window.removeEventListener("message",e),window.removeEventListener("focus",n)}},[t,r,null==l?void 0:l.hasSubscription,o,p,m]),u.current,c.current}({enabled:!0,pollingInterval:1500}),(0,s.useEffect)(()=>{!t&&e&&e.hasSubscription&&c.replace("/dashboard/subscription/stripe")},[e,t,c]),t)?(0,n.jsx)(o.ZP,{size:"lg",text:"Cargando suscripci\xf3n..."}):(null==e?void 0:e.hasSubscription)?(0,n.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,n.jsx)(o.ZP,{size:"md"}),(0,n.jsx)("span",{className:"ml-2 text-gray-600",children:"Redirigiendo a tu suscripci\xf3n..."})]}):(0,n.jsx)("div",{className:"min-h-screen bg-black p-6 no-subcription-layout",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl shadow-2xl p-8 text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-nexly-green",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),(0,n.jsx)("h2",{className:"text-3xl font-bold text-accent-cream mb-3",children:"Sin Suscripci\xf3n Activa"}),(0,n.jsx)("p",{className:"text-gray-400 text-lg mb-8 max-w-2xl mx-auto",children:"No tienes una suscripci\xf3n activa. Elige un plan para comenzar a usar todas las funciones de Nexly."}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,n.jsx)("button",{onClick:()=>window.location.href="/pricing",className:"bg-nexly-green hover:bg-green-600 text-accent-cream font-semibold px-8 py-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-lg",children:"Ver Planes Disponibles"}),(0,n.jsx)("button",{onClick:()=>window.location.href="/dashboard",className:"bg-gray-800 hover:bg-gray-700 text-gray-300 font-semibold px-8 py-4 rounded-xl transition-all duration-200 border border-gray-700 hover:border-gray-600 text-lg",children:"Volver al Dashboard"})]})]})})})}},61575:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>l});var n=r(57437),a=r(66648);function l(e){let{size:t="md",text:r,fullScreen:l=!1,className:s=""}=e,o={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"},i={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"},c={sm:"border-2",md:"border-[3px]",lg:"border-4",xl:"border-[5px]"},u=()=>(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 ".concat(s),children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"\n            ".concat(o[t]," \n            ").concat(c[t],"\n            rounded-full \n            border-transparent\n            border-t-nexly-green \n            border-r-nexly-teal\n            animate-spin\n            shadow-nexly-green/30\n          "),style:{animationDuration:"1s",animationTimingFunction:"linear"}}),(0,n.jsx)("div",{className:"\n          ".concat(o[t]," \n          rounded-full \n          absolute top-0 left-0 \n          flex items-center justify-center\n          bg-gradient-to-br from-nexly-green/10 to-nexly-teal/10\n        "),children:(0,n.jsx)(a.default,{src:"/logo_single.png",alt:"Nexly",width:48,height:48,className:"".concat(i[t]," object-contain animate-pulse"),priority:!0})})]}),r&&(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-accent-cream font-medium text-sm tracking-wide mb-2",children:r}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,n.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-green rounded-full animate-bounce shadow-lg shadow-nexly-green/50"}),(0,n.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-teal rounded-full animate-bounce shadow-lg shadow-nexly-teal/50",style:{animationDelay:"0.15s"}}),(0,n.jsx)("div",{className:"w-1.5 h-1.5 bg-nexly-green rounded-full animate-bounce shadow-lg shadow-nexly-green/50",style:{animationDelay:"0.3s"}})]})]})]});return l?(0,n.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,n.jsx)(u,{})}):(0,n.jsx)(u,{})}},12104:(e,t,r)=>{"use strict";r.d(t,{f4:()=>c,mU:()=>i,qR:()=>o});var n=r(57437),a=r(2265),l=r(67048);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,{token:r}=(0,l.a)(),[o,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),[d,m]=(0,a.useState)(null),p=(0,a.useCallback)(async()=>{if(!r){u(!1);return}try{var e;u(!0),m(null),console.log("\uD83D\uDD04 Fetching subscription status...");let t=await fetch("".concat("https://nexly-production.up.railway.app","/subscriptions/status?t=").concat(Date.now()),{headers:{Authorization:"Bearer ".concat(r),"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Error ".concat(t.status,": ").concat(t.statusText));let n=await t.json();console.log("\uD83D\uDCCA Subscription data received:",n),i(n),n.hasSubscription&&(null===(e=n.subscription)||void 0===e?void 0:e.planType)?(localStorage.setItem("selectedPlan",n.subscription.planType),localStorage.setItem("hasActiveSubscription","true")):(localStorage.removeItem("selectedPlan"),localStorage.removeItem("hasActiveSubscription"))}catch(e){console.error("❌ Error fetching subscription:",e),i({hasSubscription:!1}),m(e instanceof Error?e.message:"Error desconocido"),localStorage.removeItem("hasActiveSubscription")}finally{u(!1)}},[r]);(0,a.useEffect)(()=>{i(null),m(null),u(!0),r?p():u(!1)},[r,p]);let g=(0,a.useMemo)(()=>{var e;if(!o)return{isPaid:!1,isTrial:!1,isFree:!0,active:!1,trialActive:!1,pendingPaymentMethod:!1,paused:!1,cancelled:!1,pastDue:!1,incomplete:!1};let t=o.hasSubscription,r=o.userSubscriptionStatus,n=null===(e=o.subscription)||void 0===e?void 0:e.status,a="active_paid"===r||"active"===n,l="active_trial"===r||"trialing"===n;return{isPaid:!!a,isTrial:!!l,isFree:!(a||l)||!t,active:!!a,trialActive:!!l,pendingPaymentMethod:"trial_pending_payment_method"===r,paused:"paused"===n,cancelled:"canceled"===n,pastDue:"past_due"===n,incomplete:!!("incomplete"===n||"incomplete_expired"===n)}},[o]),h=(0,a.useCallback)(e=>{var t,r;if(!(null==o?void 0:o.hasSubscription))return!1;let n=null===(t=o.subscription)||void 0===t?void 0:t.planType;return!!n&&((null===(r=({crecimiento:["whatsapp","instagram","telegram"],pro:["whatsapp","instagram","messenger","telegram"],business:["whatsapp","instagram","messenger","telegram","tiktok","twitter"]})[n])||void 0===r?void 0:r.includes(e))||!1)},[o]),f=(0,a.useCallback)(()=>{var e;if(!(null==o?void 0:o.hasSubscription))return 0;switch(null===(e=o.subscription)||void 0===e?void 0:e.planType){case"crecimiento":return 3;case"pro":return 4;case"business":return 999;default:return 0}},[o]),v=(0,a.useCallback)(e=>{var t;i(e),m(null),e.hasSubscription&&(null===(t=e.subscription)||void 0===t?void 0:t.planType)&&(localStorage.setItem("selectedPlan",e.subscription.planType),localStorage.setItem("hasActiveSubscription","true"))},[]),b=(0,a.useCallback)(async()=>{console.log("\uD83D\uDD04 Forcing subscription context refresh..."),await p()},[p]),x=(0,a.useMemo)(()=>({subscription:o,loading:c,error:d,status:g,refetch:p,canUseFeature:h,getMaxIntegrations:f,updateAfterPayment:v,forceRefresh:b}),[o,c,d,g,p,h,f,v,b]);return(0,n.jsx)(s.Provider,{value:x,children:t})}function i(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}function c(){return(0,a.useContext)(s)}},67048:(e,t,r)=>{"use strict";r.d(t,{a:()=>a});var n=r(2265);function a(){let[e,t]=(0,n.useState)(null),[r,a]=(0,n.useState)(null),[l,s]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(e&&r)try{let n=JSON.parse(r);a(e),t(n)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}s(!1)},[]),{user:e,token:r,setAuth:(e,r)=>{a(e),t(r),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(r))},clear:()=>{a(null),t(null),localStorage.removeItem("token"),localStorage.removeItem("user")},logout:()=>{console.log("\uD83D\uDD04 Logout manual iniciado..."),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),window.location.replace("/login")},isLoading:l,isAuthenticated:!!r&&!!e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[6648,7130,6215,1744],()=>t(7030)),_N_E=e.O()}]);