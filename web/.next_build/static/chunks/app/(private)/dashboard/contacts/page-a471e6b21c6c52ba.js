(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8594],{26376:(e,t,a)=>{Promise.resolve().then(a.bind(a,95483))},95483:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var r=a(57437),n=a(2265),s=a(29039),o=a(67048);let l=async(e,t)=>{let a=await fetch("".concat("https://nexly-production.up.railway.app").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok)throw Error("Error ".concat(a.status,": ").concat(a.statusText));return a.json()};var i=a(25164),c=a(2183),d=a(98324),u=a(1584),m=a(53342),h=a(78149),p=a(71538),x="AlertDialog",[g,f]=(0,d.b)(x,[m.p8]),v=(0,m.p8)(),b=e=>{let{__scopeAlertDialog:t,...a}=e,n=v(t);return(0,r.jsx)(m.fC,{...n,...a,modal:!0})};b.displayName=x;var y=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=v(a);return(0,r.jsx)(m.xz,{...s,...n,ref:t})});y.displayName="AlertDialogTrigger";var j=e=>{let{__scopeAlertDialog:t,...a}=e,n=v(t);return(0,r.jsx)(m.h_,{...n,...a})};j.displayName="AlertDialogPortal";var w=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=v(a);return(0,r.jsx)(m.aV,{...s,...n,ref:t})});w.displayName="AlertDialogOverlay";var N="AlertDialogContent",[k,C]=g(N),A=(0,p.sA)("AlertDialogContent"),S=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,children:s,...o}=e,l=v(a),i=n.useRef(null),c=(0,u.e)(t,i),d=n.useRef(null);return(0,r.jsx)(m.jm,{contentName:N,titleName:D,docsSlug:"alert-dialog",children:(0,r.jsx)(k,{scope:a,cancelRef:d,children:(0,r.jsxs)(m.VY,{role:"alertdialog",...l,...o,ref:c,onOpenAutoFocus:(0,h.Mj)(o.onOpenAutoFocus,e=>{var t;e.preventDefault(),null===(t=d.current)||void 0===t||t.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,r.jsx)(A,{children:s}),(0,r.jsx)(O,{contentRef:i})]})})})});S.displayName=N;var D="AlertDialogTitle",z=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=v(a);return(0,r.jsx)(m.Dx,{...s,...n,ref:t})});z.displayName=D;var M="AlertDialogDescription",I=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=v(a);return(0,r.jsx)(m.dk,{...s,...n,ref:t})});I.displayName=M;var E=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,s=v(a);return(0,r.jsx)(m.x8,{...s,...n,ref:t})});E.displayName="AlertDialogAction";var L="AlertDialogCancel",P=n.forwardRef((e,t)=>{let{__scopeAlertDialog:a,...n}=e,{cancelRef:s}=C(L,a),o=v(a),l=(0,u.e)(t,s);return(0,r.jsx)(m.x8,{...o,...n,ref:l})});P.displayName=L;var O=e=>{let{contentRef:t}=e,a="`".concat(N,"` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the `").concat(N,"` by passing a `").concat(M,"` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an `id` and passing the same value to the `aria-describedby` prop in `").concat(N,"`. If the description is confusing or duplicative for sighted users, you can use the `@radix-ui/react-visually-hidden` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog");return n.useEffect(()=>{var e;document.getElementById(null===(e=t.current)||void 0===e?void 0:e.getAttribute("aria-describedby"))||console.warn(a)},[a,t]),null},T=a(49354),R=a(89733);let B=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(w,{className:(0,T.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n,ref:t})});B.displayName=w.displayName;let W=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsxs)(j,{children:[(0,r.jsx)(B,{}),(0,r.jsx)(S,{ref:t,className:(0,T.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n})]})});W.displayName=S.displayName;let H=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,T.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};H.displayName="AlertDialogHeader";let J=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,T.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};J.displayName="AlertDialogFooter";let F=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(z,{ref:t,className:(0,T.cn)("text-lg font-semibold",a),...n})});F.displayName=z.displayName;let G=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(I,{ref:t,className:(0,T.cn)("text-sm text-muted-foreground",a),...n})});G.displayName=I.displayName;let U=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(E,{ref:t,className:(0,T.cn)((0,R.d)(),a),...n})});U.displayName=E.displayName;let V=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(P,{ref:t,className:(0,T.cn)((0,R.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...n})});function _(e){let{items:t,onArchive:a,onUnarchive:n,onMessage:s,isArchiving:o=null,loading:l=!1,showArchived:i=!1}=e,d=e=>{switch(e){case"whatsapp":return(0,r.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-accent-cream text-[10px] font-bold",children:"WA"})});case"telegram":return(0,r.jsx)("div",{className:"w-6 h-6 bg-blue-400 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-accent-cream text-[10px] font-bold",children:"TG"})});case"instagram":return(0,r.jsx)("div",{className:"w-6 h-6 bg-pink-500 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-accent-cream text-[10px] font-bold",children:"IG"})});case"messenger":return(0,r.jsx)("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-accent-cream text-[10px] font-bold",children:"M"})});default:return(0,r.jsx)("div",{className:"w-6 h-6 bg-neutral-500 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-accent-cream text-[10px] font-bold",children:"?"})})}},u=e=>{if(!e)return null;let t=new Date(e),a=Math.floor((new Date().getTime()-t.getTime())/864e5);return 0===a?"Hoy":1===a?"Ayer":a<7?"Hace ".concat(a," d\xedas"):a<30?"Hace ".concat(Math.floor(a/7)," semanas"):t.toLocaleDateString("es-ES",{day:"numeric",month:"short"})},m=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?";return l?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((e,t)=>(0,r.jsxs)("div",{className:"bg-neutral-800 rounded-lg p-4 border border-neutral-700",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,r.jsx)(c.O,{className:"w-12 h-12 rounded-full"}),(0,r.jsx)(c.O,{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full"})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsx)(c.O,{className:"h-4 w-24"}),(0,r.jsx)(c.O,{className:"h-3 w-12"})]}),(0,r.jsx)(c.O,{className:"h-3 w-20"}),(0,r.jsx)(c.O,{className:"h-3 w-32"}),(0,r.jsx)(c.O,{className:"h-3 w-28"})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4 pt-3 border-t border-neutral-700",children:[(0,r.jsx)(c.O,{className:"h-8 w-20"}),(0,r.jsx)(c.O,{className:"h-8 w-16"})]})]},t))}):(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsx)("div",{className:"space-y-4",children:0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-neutral-400 mb-2",children:"No hay contactos a\xfan"}),(0,r.jsx)("p",{className:"text-neutral-500 mb-4",children:"Los contactos aparecer\xe1n autom\xe1ticamente cuando alguien te escriba por primera vez"}),(0,r.jsxs)("div",{className:"text-sm text-neutral-600 space-y-1",children:[(0,r.jsx)("p",{children:"\uD83D\uDCF1 WhatsApp: Cuando alguien te env\xede un mensaje"}),(0,r.jsx)("p",{children:"\uD83D\uDCF8 Instagram: Cuando recibas un DM"}),(0,r.jsx)("p",{children:"\uD83D\uDCAC Messenger: Cuando alguien te contacte"})]})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>{var t;return console.log("Contact debug:",{id:e.id,name:e.name,isArchived:e.isArchived,showArchived:i}),(0,r.jsxs)("div",{className:"bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-green-600/30 transition-all cursor-pointer group ".concat(e.isArchived&&!i?"hidden":""),children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsxs)("div",{className:"relative flex-shrink-0",children:[e.avatar||e.profilePicture?(0,r.jsx)("img",{src:e.avatar||e.profilePicture,alt:e.name||"Avatar",className:"w-12 h-12 rounded-full object-cover",onError:e=>{e.currentTarget.style.display="none";let t=e.currentTarget.nextElementSibling;t&&(t.style.display="flex")}}):null,(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-600 to-green-700 rounded-full flex items-center justify-center text-accent-cream font-semibold text-sm",style:{display:e.avatar||e.profilePicture?"none":"flex"},children:m(e.name)}),(0,r.jsx)("div",{className:"absolute -bottom-1 -right-1",children:d(e.provider)})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[(0,r.jsx)("h4",{className:"font-medium text-accent-cream truncate",children:e.name||"Sin nombre"}),e.lastInteraction&&(0,r.jsx)("span",{className:"text-xs text-neutral-500 flex-shrink-0",children:u(e.lastInteraction)})]}),(null===(t=e.platformData)||void 0===t?void 0:t.telegramUsername)&&(0,r.jsxs)("p",{className:"text-xs text-blue-400 mb-1",children:["@",e.platformData.telegramUsername]}),e.lastMessagePreview&&(0,r.jsx)("p",{className:"text-sm text-neutral-400 truncate mb-2",children:e.lastMessagePreview}),e.phone&&(0,r.jsxs)("p",{className:"text-xs text-neutral-500 flex items-center gap-1",children:[(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.phone]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4 pt-3 border-t border-neutral-700 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,r.jsxs)("button",{onClick:t=>{t.stopPropagation(),s?s(e):window.location.href="/dashboard/inbox?contact=".concat(e.id)},className:"text-green-500 hover:text-green-400 px-3 py-1.5 rounded-lg text-sm transition-colors flex items-center gap-2",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Mensaje"]}),i?(0,r.jsxs)(b,{children:[(0,r.jsx)(y,{asChild:!0,children:(0,r.jsxs)("button",{onClick:e=>e.stopPropagation(),disabled:o===e.id,className:"text-green-400 hover:text-green-300 disabled:text-neutral-600 disabled:cursor-not-allowed px-3 py-1.5 rounded-lg text-sm transition-colors flex items-center gap-2",title:"Recuperar contacto",children:[o===e.id?(0,r.jsxs)("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),"Recuperar"]})}),(0,r.jsxs)(W,{children:[(0,r.jsxs)(H,{children:[(0,r.jsx)(F,{children:"\uD83D\uDD04 Recuperar contacto"}),(0,r.jsxs)(G,{children:["El contacto"," ",(0,r.jsx)("strong",{children:e.name||e.phone||"este contacto"})," ","volver\xe1 a aparecer en la vista principal de contactos."]})]}),(0,r.jsxs)(J,{children:[(0,r.jsx)(V,{children:"Cancelar"}),(0,r.jsx)(U,{onClick:()=>null==n?void 0:n(e.id),className:"bg-green-500 hover:bg-green-600",children:"Recuperar"})]})]})]}):(0,r.jsxs)(b,{children:[(0,r.jsx)(y,{asChild:!0,children:(0,r.jsxs)("button",{onClick:e=>e.stopPropagation(),disabled:o===e.id,className:"text-orange-400 hover:text-orange-300 disabled:text-neutral-600 disabled:cursor-not-allowed px-3 py-1.5 rounded-lg text-sm transition-colors flex items-center gap-2",title:"Archivar contacto (se puede recuperar m\xe1s tarde)",children:[o===e.id?(0,r.jsxs)("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8l4 4-4 4m9-4H9m8 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Archivar"]})}),(0,r.jsxs)(W,{children:[(0,r.jsxs)(H,{children:[(0,r.jsx)(F,{children:"\uD83D\uDCE6 Archivar contacto"}),(0,r.jsxs)(G,{children:["El contacto"," ",(0,r.jsx)("strong",{children:e.name||e.phone||"este contacto"})," ","se ocultar\xe1 de la vista principal pero podr\xe1s recuperarlo m\xe1s tarde desde la secci\xf3n de contactos archivados."]})]}),(0,r.jsxs)(J,{children:[(0,r.jsx)(V,{children:"Cancelar"}),(0,r.jsx)(U,{onClick:()=>a(e.id),className:"bg-orange-500 hover:bg-orange-600",children:"Archivar"})]})]})]})]})]},e.id)})})})})}V.displayName=P.displayName;var Z=a(11870),q=a(92800);let Y=[...a(52686).Du];function $(){let{token:e}=(0,o.a)(),{refreshContacts:t}=(0,i.p)(),[a,c]=(0,n.useState)("telegram"),[d,u]=(0,n.useState)(""),[m,h]=(0,n.useState)(null),[p,x]=(0,n.useState)(!1),{showSuccess:g,showError:f}=(0,Z.w)(),{syncAll:v,syncIntegration:b,isSyncing:y,syncProgress:j}=function(){let{token:e}=(0,o.a)(),{showSuccess:t,showError:a}=(0,Z.w)(),[r,s]=(0,n.useState)(!1),[l,i]=(0,n.useState)(null);return{syncAll:async r=>{if(!e)return a("Error","No est\xe1s autenticado"),null;s(!0),i("Sincronizando contactos...");try{let n=await (0,q.x4)(e);if(!n.success)return a("Error",n.message||"Error al sincronizar contactos"),n;{let{totalSynced:e,totalCreated:a,totalUpdated:s}=n.summary||{totalSynced:0,totalCreated:0,totalUpdated:0};return t("Sincronizaci\xf3n completada","".concat(e," contactos sincronizados (").concat(a," nuevos, ").concat(s," actualizados)")),r&&r(),n}}catch(e){var n,o;return a("Error",(null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)||(null==e?void 0:e.message)||"Error al sincronizar contactos"),null}finally{s(!1),i(null)}},syncIntegration:async(r,n)=>{if(!e)return a("Error","No est\xe1s autenticado"),null;s(!0),i("Sincronizando ".concat(r,"..."));try{let s=await (0,q.aS)(r,e);if(!s.success||!s.result)return a("Error",s.message||"Error al sincronizar integraci\xf3n"),s;{let{contactsSynced:e,contactsCreated:a,contactsUpdated:r,provider:o}=s.result;return t("Sincronizaci\xf3n completada","".concat(e," contactos de ").concat(o," sincronizados (").concat(a," nuevos, ").concat(r," actualizados)")),n&&n(),s}}catch(e){var o,l;return a("Error",(null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(o=l.data)||void 0===o?void 0:o.message)||(null==e?void 0:e.message)||"Error al sincronizar integraci\xf3n"),null}finally{s(!1),i(null)}},isSyncing:r,syncProgress:l}}(),{items:w,loading:N,error:k,refetch:C,refetchAll:A,counts:S}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{token:r}=(0,o.a)(),i=new URLSearchParams;e&&i.set("integrationId",e),t&&i.set("archived","true");let c=r?"/contacts".concat(i.toString()?"?".concat(i.toString()):""):null,d=new URLSearchParams;e&&d.set("integrationId",e);let u=r&&a?"/contacts".concat(d.toString()?"?".concat(d.toString()):""):null,m=new URLSearchParams;e&&m.set("integrationId",e),m.set("archived","true");let h=r&&a?"/contacts?".concat(m.toString()):null,{data:p,error:x,isLoading:g,mutate:f}=(0,s.ZP)(c,e=>l(e,r),{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:3e4,refreshInterval:6e4,keepPreviousData:!0,fallbackData:[]}),{data:v,mutate:b}=(0,s.ZP)(u,e=>l(e,r),{revalidateOnFocus:!1,dedupingInterval:6e4,fallbackData:[]}),{data:y,mutate:j}=(0,s.ZP)(h,e=>l(e,r),{revalidateOnFocus:!1,dedupingInterval:6e4,fallbackData:[]}),w=(0,n.useMemo)(()=>{if(a)return{active:Array.isArray(v)?v.length:0,archived:Array.isArray(y)?y.length:0}},[a,v,y]),N=(0,n.useMemo)(()=>Array.isArray(p)?p:[],[p]),k=x?x.message||"No se pudieron cargar los contactos":null,C=async()=>{await Promise.all([f(),a?b():Promise.resolve(),a?j():Promise.resolve()])};return{items:N,loading:g,error:k,refetch:f,refetchAll:C,counts:w}}(a,p,!0);console.log("ContactsPage debug:",{integrationId:a,showArchived:p,contactsCount:(null==w?void 0:w.length)||0,contacts:null==w?void 0:w.slice(0,2),loading:N,error:k,counts:S});let D=(0,n.useMemo)(()=>{let e=Array.isArray(w)?w:[];return d.trim()?e.filter(e=>{var t,a,r;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null===(a=e.phone)||void 0===a?void 0:a.toLowerCase().includes(d.toLowerCase()))||(null===(r=e.email)||void 0===r?void 0:r.toLowerCase().includes(d.toLowerCase()))}):e},[w,d]),z=(e,t)=>{var a,r;console.error("Error en ".concat(t,":"),e),f("Error",(null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||(null==e?void 0:e.message)||"Error en ".concat(t))};async function M(a){if(!e){f("Error","No tienes permisos para realizar esta acci\xf3n");return}h(a);try{let r=await fetch("".concat("https://nexly-production.up.railway.app","/contacts/").concat(a,"/archive"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({archived:!0})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Error ".concat(r.status,": ").concat(r.statusText))}let n=await r.json();g("Contacto archivado",n.message||"Contacto archivado exitosamente. Puedes recuperarlo m\xe1s tarde."),t(),await A()}catch(e){z(e,"archivar contacto")}finally{h(null)}}async function I(a){if(!e){f("Error","No tienes permisos para realizar esta acci\xf3n");return}h(a);try{let r=await fetch("".concat("https://nexly-production.up.railway.app","/contacts/").concat(a,"/archive"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({archived:!1})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"Error ".concat(r.status,": ").concat(r.statusText))}let n=await r.json();g("Contacto recuperado",n.message||"Contacto recuperado exitosamente."),t(),await A()}catch(e){z(e,"recuperar contacto")}finally{h(null)}}async function E(){await v(()=>{t(),C()})}async function L(e){await b(e,()=>{t(),C()})}return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-accent-dark text-accent-cream",children:[(0,r.jsxs)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-accent-cream",children:"Contactos"}),(0,r.jsx)("p",{className:"text-neutral-400 mt-1",children:"Gestiona tus contactos de todas las plataformas"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("div",{className:"flex bg-neutral-700 rounded-lg p-1",children:[(0,r.jsxs)("button",{onClick:()=>x(!1),className:"px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(p?"text-neutral-300 hover:text-accent-cream":"bg-neutral-600 text-accent-cream"),children:["Activos (",(null==S?void 0:S.active)||0,")"]}),(0,r.jsxs)("button",{onClick:()=>x(!0),className:"px-3 py-1.5 rounded-md text-sm font-medium transition-colors ".concat(p?"bg-neutral-600 text-accent-cream":"text-neutral-300 hover:text-accent-cream"),children:["\uD83D\uDCE6 Archivados (",(null==S?void 0:S.archived)||0,")"]})]}),(0,r.jsx)("button",{onClick:E,disabled:y,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-accent-cream px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),j||"Sincronizando..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sincronizar"]})}),(0,r.jsxs)("button",{onClick:()=>window.location.href="/dashboard/integrations",className:"bg-green-600 hover:bg-green-700 text-accent-cream px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Conectar Apps"]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,r.jsx)("div",{className:"flex gap-2",children:Y.map(e=>(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsxs)("button",{onClick:()=>c(e.id),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors capitalize flex items-center gap-2 ".concat(a===e.id?"".concat(e.color," text-accent-cream shadow-lg"):"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"),children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(e.color)}),e.label]}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),L(e.id)},disabled:y,className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 hover:bg-blue-600 text-accent-cream rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-50",title:"Sincronizar ".concat(e.label),children:y?(0,r.jsxs)("svg",{className:"w-3 h-3 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]},e.id))}),(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Buscar contactos...",value:d,onChange:e=>u(e.target.value),className:"w-full bg-neutral-700 border border-neutral-600 rounded-lg px-4 py-2 pl-10 text-accent-cream placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,r.jsx)("div",{className:"absolute left-3 top-2.5 text-neutral-400",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-6 mt-4 text-sm text-neutral-400",children:[(0,r.jsx)("span",{children:p?"Archivados: ".concat(Array.isArray(w)?w.length:0," contactos"):"Activos: ".concat(Array.isArray(w)?w.length:0," contactos")}),d&&(0,r.jsxs)("span",{children:["Filtrados: ",Array.isArray(D)?D.length:0," resultados"]})]})]}),(0,r.jsx)("div",{className:"flex-1 p-6",children:k?(0,r.jsxs)("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-6 text-center",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-red-400 mb-2",children:"Error al cargar contactos"}),(0,r.jsx)("p",{className:"text-red-300 mb-4",children:k}),(0,r.jsx)("button",{onClick:()=>C(),className:"bg-red-600 hover:bg-red-700 text-accent-cream px-4 py-2 rounded-lg transition-colors",children:"Intentar de nuevo"})]}):(0,r.jsx)(_,{items:D.map(e=>({id:e._id||e.id,name:e.name,phone:e.phone,email:e.email,integrationId:e.integrationId,provider:e.provider,avatar:e.avatar,profilePicture:e.profilePicture,lastInteraction:e.lastInteraction,lastMessagePreview:e.lastMessagePreview,isArchived:e.isArchived,platformData:e.platformData})),onArchive:M,onUnarchive:I,onMessage:function(e){let t=e.id,r=e.provider||a||"telegram";console.log("Opening inbox for contact:",{contactId:t,provider:r,integrationId:a}),window.location.href="/dashboard/inbox?contact=".concat(t,"&channel=").concat(r)},isArchiving:m,loading:N,showArchived:p})})]})}},89733:(e,t,a)=>{"use strict";a.d(t,{d:()=>o,z:()=>l});var r=a(57437),n=a(2265),s=a(44839);let o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.W)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===e.variant||!e.variant,"bg-destructive text-destructive-foreground hover:bg-destructive/90":"destructive"===e.variant,"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"outline"===e.variant,"bg-secondary text-secondary-foreground hover:bg-secondary/80":"secondary"===e.variant,"hover:bg-accent hover:text-accent-foreground":"ghost"===e.variant,"text-primary underline-offset-4 hover:underline":"link"===e.variant},{"h-10 px-4 py-2":!0})},l=n.forwardRef((e,t)=>{let{className:a,variant:n="default",size:o="default",children:l,...i}=e;return(0,r.jsx)("button",{className:(0,s.W)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===n,"bg-destructive text-destructive-foreground hover:bg-destructive/90":"destructive"===n,"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"outline"===n,"bg-secondary text-secondary-foreground hover:bg-secondary/80":"secondary"===n,"hover:bg-accent hover:text-accent-foreground":"ghost"===n,"text-primary underline-offset-4 hover:underline":"link"===n},{"h-10 px-4 py-2":"default"===o,"h-9 rounded-md px-3":"sm"===o,"h-11 rounded-md px-8":"lg"===o,"h-10 w-10":"icon"===o},a),ref:t,...i,children:l})});l.displayName="Button"},2183:(e,t,a)=>{"use strict";a.d(t,{O:()=>s});var r=a(57437),n=a(44839);function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.Z)("animate-pulse rounded-md bg-neutral-700",t),...a})}},67048:(e,t,a)=>{"use strict";a.d(t,{a:()=>n});var r=a(2265);function n(){let[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(null),[s,o]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=localStorage.getItem("token"),a=localStorage.getItem("user");if(e&&a)try{let r=JSON.parse(a);n(e),t(r)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}o(!1)},[]),{user:e,token:a,setAuth:(e,a)=>{n(e),t(a),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(a))},clear:()=>{n(null),t(null),localStorage.removeItem("token"),localStorage.removeItem("user")},logout:()=>{console.log("\uD83D\uDD04 Logout manual iniciado..."),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),window.location.replace("/login")},isLoading:s,isAuthenticated:!!a&&!!e}}},25164:(e,t,a)=>{"use strict";a.d(t,{p:()=>s});var r=a(2265),n=a(29039);function s(){let e=(0,r.useCallback)(()=>{(0,n.JG)(e=>Array.isArray(e)&&"/integrations"===e[0]),(0,n.JG)(e=>Array.isArray(e)&&"/contacts"===e[0]),(0,n.JG)(e=>Array.isArray(e)&&"/inbox"===e[0]),(0,n.JG)(e=>Array.isArray(e)&&"/messages"===e[0]),(0,n.JG)(e=>Array.isArray(e)&&"/conversations"===e[0])},[]),t=(0,r.useCallback)(()=>{(0,n.JG)(e=>Array.isArray(e)&&"/integrations"===e[0])},[]),a=(0,r.useCallback)(()=>{(0,n.JG)(e=>Array.isArray(e)&&"/contacts"===e[0])},[]);return{refreshAll:e,refreshIntegrations:t,refreshContacts:a,refreshInbox:(0,r.useCallback)(()=>{(0,n.JG)(e=>Array.isArray(e)&&"/inbox"===e[0])},[]),refreshMessages:(0,r.useCallback)(()=>{(0,n.JG)(e=>Array.isArray(e)&&"/messages"===e[0])},[]),refreshConversations:(0,r.useCallback)(()=>{(0,n.JG)(e=>Array.isArray(e)&&"/conversations"===e[0])},[])}}},11870:(e,t,a)=>{"use strict";a.d(t,{w:()=>n});var r=a(2265);function n(){let{showNotification:e}=function(){let[e,t]=(0,r.useState)([]),a=(0,r.useCallback)(e=>{var a;let r=Math.random().toString(36).substr(2,9),s={id:r,duration:null!==(a=e.duration)&&void 0!==a?a:5e3,...e};t(e=>[...e,s]),s.duration&&s.duration>0&&setTimeout(()=>{n(r)},s.duration)},[]),n=(0,r.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]);return{notifications:e,showNotification:a,hideNotification:n,clearAll:(0,r.useCallback)(()=>{t([])},[])}}(),t=(0,r.useCallback)((t,a)=>{e({type:"success",title:t,message:a})},[e]);return{showSuccess:t,showError:(0,r.useCallback)((t,a)=>{e({type:"error",title:t,message:a,duration:0})},[e]),showInfo:(0,r.useCallback)((t,a)=>{e({type:"info",title:t,message:a})},[e]),showWarning:(0,r.useCallback)((t,a)=>{e({type:"warning",title:t,message:a})},[e])}}},92800:(e,t,a)=>{"use strict";a.d(t,{SC:()=>s,T5:()=>r,ZP:()=>u,aS:()=>i,oJ:()=>d,qL:()=>o,qi:()=>c,x4:()=>l});let r="https://nexly-production.up.railway.app".replace(/\/+$/,""),n=e=>"".concat(r).concat(e.startsWith("/")?e:"/".concat(e));async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,r=a||function(){if("undefined"==typeof document)return;let e=document.cookie.match(/(?:^|;\s*)token=([^;]+)/);return e?decodeURIComponent(e[1]):void 0}(),s=await fetch(n(e),{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...t.headers||{}}});if(!s.ok){if(401===s.status)throw console.warn("\uD83D\uDD12 Token expirado detectado en:",e),console.warn("\uD83D\uDCC5 Timestamp:",new Date().toISOString()),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),console.warn("\uD83D\uDE80 Ejecutando logout autom\xe1tico..."),window.location.replace("/login"),Error("Sesi\xf3n expirada. Redirigiendo al login...");let t="HTTP ".concat(s.status);try{let e=await s.json();t=(null==e?void 0:e.message)||(null==e?void 0:e.error)||t}catch(e){}throw Error(t)}if(204!==s.status)return await s.json()}function o(e){return s("/auth/register",{method:"POST",body:JSON.stringify(e)})}function l(e){return s("/contacts/sync",{method:"POST"},e)}function i(e,t){return s("/contacts/sync/provider/".concat(e),{method:"POST"},t)}function c(e,t){let a=localStorage.getItem("token");return s("/ai/analyze",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}},body:JSON.stringify({message:e,context:t})})}function d(e,t){let a=localStorage.getItem("token");return s("/ai/generate-response",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}},body:JSON.stringify({message:e,businessContext:t})})}let u=s},52686:(e,t,a)=>{"use strict";a.d(t,{Du:()=>n,pD:()=>r});let r=["whatsapp","instagram","messenger","telegram"],n=[{id:"whatsapp",label:"WhatsApp",color:"bg-green-500",description:"Conecta tu cuenta de WhatsApp Business para enviar y recibir mensajes."},{id:"instagram",label:"Instagram",color:"bg-gradient-to-r from-purple-500 to-pink-500",description:"Conecta tu cuenta de Instagram para gestionar mensajes directos."},{id:"messenger",label:"Facebook Messenger",color:"bg-blue-500",description:"Conecta Facebook Messenger para gestionar conversaciones."},{id:"tiktok",label:"TikTok",color:"bg-black",description:"Conecta TikTok para gestionar mensajes y comentarios."},{id:"telegram",label:"Telegram",color:"bg-blue-500",description:"Conecta tu cuenta personal de Telegram para gestionar todos tus chats y mensajes."}]},49354:(e,t,a)=>{"use strict";a.d(t,{cn:()=>s});var r=a(44839),n=a(96164);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,r.W)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[4868,9039,3342,7130,6215,1744],()=>t(26376)),_N_E=e.O()}]);