(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3533],{7126:(e,t,s)=>{Promise.resolve().then(s.bind(s,2057))},16463:(e,t,s)=>{"use strict";var a=s(71169);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},2057:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(57437),r=s(29039),n=s(67048),l=s(25164),o=s(2265);function c(e){let{items:t,activeId:s,onSelect:r,searchQuery:n=""}=e,l=(0,o.useMemo)(()=>n.trim()?t.filter(e=>e.title.toLowerCase().includes(n.toLowerCase())||e.last.toLowerCase().includes(n.toLowerCase())):t,[t,n]),c=e=>{try{let t=new Date(e),s=new Date().getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(a/60),n=Math.floor(r/24);if(a<1)return"Ahora";if(a<60)return"".concat(a,"m");if(r<24)return"".concat(r,"h");if(n<7)return"".concat(n,"d");return t.toLocaleDateString("es-ES",{day:"numeric",month:"short"})}catch(t){return e}},i=(e,t)=>{let s=(e||"Sin nombre").split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2);return(0,a.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full ".concat({whatsapp:"bg-green-500",instagram:"bg-pink-500",messenger:"bg-blue-500",telegram:"bg-blue-400"}[t]||"bg-neutral-500"," flex items-center justify-center text-accent-cream font-semibold text-xs sm:text-sm"),children:s})};return(0,a.jsx)(a.Fragment,{children:0===l.length?(0,a.jsx)("div",{className:"p-4 text-center text-neutral-400",children:n?(0,a.jsxs)("div",{children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsx)("p",{children:"No se encontraron conversaciones"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Intenta con otros t\xe9rminos de b\xfasqueda"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("svg",{className:"w-12 h-12 mx-auto mb-3 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{children:"No hay conversaciones"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Las nuevas conversaciones aparecer\xe1n aqu\xed"})]})}):(0,a.jsx)("ul",{className:"divide-y divide-neutral-700",children:l.map(e=>(0,a.jsx)("li",{onClick:()=>r(e.id),className:"p-4 hover:bg-neutral-700 cursor-pointer transition-colors ".concat(s===e.id?"bg-neutral-700 border-r-2 border-green-500":""),children:(0,a.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:i(e.title,e.platform)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h3",{className:"font-medium text-accent-cream truncate text-sm sm:text-base",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.unread&&(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-xs text-neutral-400 whitespace-nowrap",children:c(e.at)})]})]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-neutral-300 truncate",children:e.last}),"telegram"===e.platform&&e.telegramUsername&&(0,a.jsxs)("p",{className:"text-xs text-neutral-500 truncate",children:["@",e.telegramUsername]}),"telegram"===e.platform&&e.chatType&&(0,a.jsx)("p",{className:"text-xs text-neutral-500 capitalize",children:e.chatType})]})]})},e.id))})})}var i=s(2183);function d(e){let{threadId:t,token:s,channel:n,onMessageSent:l}=e,c=(0,o.useRef)(null),d=t&&n&&("telegram"===n&&(t.includes("telegram_")||/^\d+$/.test(t))||"whatsapp"===n&&(t.includes("whatsapp_")||/^\d+$/.test(t))||"instagram"===n&&t.includes("instagram_")||"messenger"===n&&(t.includes("messenger_")||/^\d+$/.test(t))),{data:m,mutate:u,isLoading:x}=(0,r.ZP)(t&&s&&d?["/integrations/conversations/".concat(t,"/messages"),s,n]:null,async e=>{let[s,a,r]=e,n=s;"telegram"===r&&(n="/telegram/messages/".concat(t));let l=await fetch("".concat("https://nexly-production.up.railway.app").concat(n),{headers:{Authorization:"Bearer ".concat(a)}}),o=await l.json();return o.messages?o.messages.map(e=>{var t;let s="",a="",n="inbound";return"telegram"===r?(s=e.text||"",a=e.date?new Date(e.date).toISOString():new Date().toISOString(),n=e.isOutgoing?"outbound":"inbound"):(s=e.body||e.content||e.text||"",a=e.timestamp||e.date?new Date(e.timestamp||e.date).toISOString():new Date().toISOString(),n="business"===e.from||e.isOutgoing?"outbound":"inbound"),{id:(null===(t=e.id)||void 0===t?void 0:t.toString())||e.messageId||Math.random().toString(),content:s,timestamp:a,direction:n,type:"text",status:e.status||"delivered"}}).reverse():[]},{refreshInterval:5e3,revalidateOnFocus:!0,revalidateOnReconnect:!0}),h=m||[];(0,o.useEffect)(()=>{let e=e=>{u()};return window.addEventListener("messageSent",e),()=>{window.removeEventListener("messageSent",e)}},[t,u]),(0,o.useEffect)(()=>{c.current&&c.current.scrollIntoView({behavior:"smooth"})},[h]);let g=e=>new Date(e).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),p=e=>{switch(e){case"sent":return(0,a.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full"});case"delivered":return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full -ml-1"})]});case"read":return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full -ml-1"})]});default:return null}};return t&&d?x?(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-accent-dark",children:[(0,a.jsx)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(i.O,{className:"h-10 w-10 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-32"}),(0,a.jsx)(i.O,{className:"h-3 w-20"})]}),(0,a.jsx)(i.O,{className:"h-6 w-6 rounded"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-32"}),(0,a.jsx)(i.O,{className:"h-3 w-16"})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-28"}),(0,a.jsx)(i.O,{className:"h-3 w-12"})]})}),(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-40"}),(0,a.jsx)(i.O,{className:"h-3 w-20"})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-36"}),(0,a.jsx)(i.O,{className:"h-3 w-14"})]})}),(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-24"}),(0,a.jsx)(i.O,{className:"h-3 w-18"})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-32"}),(0,a.jsx)(i.O,{className:"h-3 w-16"})]})})]})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-accent-dark",children:[(0,a.jsx)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-accent-cream font-semibold",children:t.slice(0,2).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium text-accent-cream",children:["Conversaci\xf3n ",t]}),(0,a.jsxs)("p",{className:"text-sm text-neutral-400 capitalize",children:[n," • Activo"]})]})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[h.map((e,t)=>(0,a.jsx)("div",{className:"flex ".concat("outbound"===e.direction?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("outbound"===e.direction?"bg-green-600 text-accent-cream":"bg-neutral-700 text-accent-cream"),children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1",children:[(0,a.jsx)("span",{className:"text-xs opacity-70",children:g(e.timestamp)}),"outbound"===e.direction&&(0,a.jsx)("div",{className:"ml-1",children:p(e.status)})]})]})},e.id)),(0,a.jsx)("div",{ref:c})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center bg-accent-dark",children:(0,a.jsxs)("div",{className:"text-center text-neutral-400",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Selecciona una conversaci\xf3n"}),(0,a.jsxs)("p",{className:"text-sm",children:["Elige una conversaci\xf3n de ",n," para comenzar a chatear"]})]})})}var m=s(92800);function u(e){let{message:t,onResponseGenerated:s,onAnalysisComplete:r,disabled:n=!1}=e,[l,c]=(0,o.useState)(!1),[i,d]=(0,o.useState)(!1),[u,x]=(0,o.useState)(null),[h,g]=(0,o.useState)(!1),[p,f]=(0,o.useState)(null),j=async()=>{if(t.trim()&&!n){c(!0),f(null);try{let e=await (0,m.qi)(t.trim());if(e.success)x(e.analysis),r(e.analysis),g(!0);else throw Error("Error en el an\xe1lisis")}catch(e){console.error("Error analizando mensaje:",e),f(e.message||"Error al analizar el mensaje")}finally{c(!1)}}},v=async()=>{if(t.trim()&&!n){d(!0),f(null);try{let e=await (0,m.oJ)(t.trim());if(e.success)s(e.response),g(!1);else throw Error("Error generando respuesta")}catch(e){console.error("Error generando respuesta:",e),f(e.message||"Error al generar respuesta")}finally{d(!1)}}};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:j,disabled:!t.trim()||n||l,className:"\n          flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors\n          ".concat(!t.trim()||n?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-accent-cream","\n        "),children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{children:"Analizando..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),(0,a.jsx)("span",{children:"IA"})]})}),h&&u&&(0,a.jsx)("div",{className:"absolute bottom-full mb-2 right-0 w-80 bg-gray-800 border border-gray-700 rounded-lg shadow-xl z-50",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-accent-cream",children:"An\xe1lisis de IA"}),(0,a.jsx)("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-accent-cream",children:(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Sentimiento:"}),(0,a.jsxs)("span",{className:"text-sm font-medium ".concat((e=>{switch(e){case"positive":return"text-green-500";case"negative":return"text-red-500";default:return"text-gray-500"}})(u.sentiment)),children:[(e=>{switch(e){case"positive":return"\uD83D\uDE0A";case"negative":return"\uD83D\uDE1E";default:return"\uD83D\uDE10"}})(u.sentiment)," ",u.sentiment]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Categor\xeda:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-accent-cream",children:[(e=>{switch(e){case"sales":return"\uD83D\uDCB0";case"support":default:return"\uD83D\uDCAC";case"complaint":return"⚠️"}})(u.category)," ",u.category]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-300",children:"Confianza:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-accent-cream",children:[u.confidence,"%"]})]}),u.suggestedResponse&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-300 block mb-1",children:"Respuesta sugerida:"}),(0,a.jsx)("div",{className:"bg-gray-700 p-2 rounded text-sm text-gray-200",children:u.suggestedResponse})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2 mt-4",children:[(0,a.jsx)("button",{onClick:v,disabled:i,className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-accent-cream px-3 py-2 rounded text-sm font-medium transition-colors",children:i?"Generando...":"Usar IA"}),(0,a.jsx)("button",{onClick:()=>g(!1),className:"px-3 py-2 bg-gray-600 hover:bg-gray-700 text-accent-cream rounded text-sm font-medium transition-colors",children:"Cerrar"})]})]})}),p&&(0,a.jsx)("div",{className:"absolute bottom-full mb-2 right-0 w-80 bg-red-800 border border-red-600 rounded-lg shadow-xl z-50 p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-red-200",children:p}),(0,a.jsx)("button",{onClick:()=>f(null),className:"text-red-300 hover:text-red-100",children:(0,a.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})}function x(e){let{threadId:t,token:s,onSend:n,channel:l="whatsapp",maxLength:c=4096,placeholder:i,onTyping:d,onAttachmentClick:m,disabled:x=!1}=e,[h,g]=(0,o.useState)(""),[p,f]=(0,o.useState)(!1),[j,v]=(0,o.useState)(!1),{canSendMessage:b,getRemainingMessages:N,getUsedMessages:w,getMaxMessages:y}=function(e){let{data:t,error:s,mutate:a}=(0,r.ZP)(e?["/messages/limits",e]:null,async e=>{let[t,s]=e,a=await fetch("".concat("https://nexly-production.up.railway.app").concat(t),{headers:{Authorization:"Bearer ".concat(s)}});if(!a.ok)throw Error("Failed to fetch limits");return a.json()}),n=e=>(null==t?void 0:t.limits)&&t.limits.find(t=>t.provider===e)||null;return{limits:(null==t?void 0:t.limits)||[],loading:!t&&!s,error:s,refetch:a,getLimitForProvider:n,canSendMessage:e=>{let t=n(e);return!t||t.canSend},getRemainingMessages:e=>{let t=n(e);return t?t.remaining:999},getUsedMessages:e=>{let t=n(e);return t?t.usedToday:0},getMaxMessages:e=>{let t=n(e);return t?t.maxMessages:999}}}(s),[k,S]=(0,o.useState)(null),[C,L]=(0,o.useState)(!1),M=(0,o.useRef)(null),A=(0,o.useRef)(null),O=(0,o.useRef)(null);(0,o.useEffect)(()=>{M.current&&(M.current.style.height="auto",M.current.style.height=M.current.scrollHeight+"px")},[h]),(0,o.useEffect)(()=>(d&&h.trim()&&(v(!0),d(!0),A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{v(!1),d(!1)},2e3)),()=>{A.current&&clearTimeout(A.current)}),[h,d]),(0,o.useEffect)(()=>()=>{d&&j&&d(!1)},[d,j]);let E=async()=>{if(h.trim()&&!p&&!x){if(h.length>c){S("El mensaje es demasiado largo (m\xe1ximo ".concat(c," caracteres)"));return}if(!t){S("No hay conversaci\xf3n seleccionada");return}if(!s){S("No est\xe1s autenticado");return}f(!0),S(null);try{await n(h.trim()),g(""),S(null),M.current&&M.current.focus()}catch(e){console.error("❌ Error enviando mensaje:",e),S((null==e?void 0:e.message)||"Error al enviar el mensaje")}finally{f(!1)}}},I=e=>{let t=M.current;if(t){let s=t.selectionStart,a=t.selectionEnd,r=h.substring(0,s)+e+h.substring(a);r.length<=c&&(g(r),setTimeout(()=>{t.selectionStart=t.selectionEnd=s+e.length,t.focus()},0))}L(!1)};return t?(0,a.jsxs)("div",{className:"border-t border-neutral-700 bg-neutral-800",children:[k&&(0,a.jsx)("div",{className:"px-4 pt-3",children:(0,a.jsx)("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-red-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("span",{className:"text-red-300 text-sm",children:k}),(0,a.jsx)("button",{onClick:()=>S(null),className:"ml-auto text-red-400 hover:text-red-300",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-end gap-3",children:[(0,a.jsx)("input",{ref:O,type:"file",onChange:e=>{let t=e.target.files;t&&t.length>0&&(S("La funci\xf3n de adjuntar archivos estar\xe1 disponible pr\xf3ximamente"),e.target.value="")},className:"hidden",accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx"}),(0,a.jsx)("button",{type:"button",onClick:()=>{if(m)m();else{var e;null===(e=O.current)||void 0===e||e.click()}},disabled:x||p,className:"flex-shrink-0 p-2 text-neutral-400 hover:text-neutral-300 disabled:text-neutral-600 disabled:cursor-not-allowed transition-colors",title:"Adjuntar archivo",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,a.jsx)("button",{type:"button",onClick:()=>L(!C),disabled:x||p,className:"flex-shrink-0 p-2 text-neutral-400 hover:text-neutral-300 disabled:text-neutral-600 disabled:cursor-not-allowed transition-colors",title:"Emojis",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("textarea",{ref:M,value:h,onChange:e=>{let t=e.target.value;t.length<=c&&(g(t),S(null))},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},placeholder:i||"Escribe un mensaje en ".concat((()=>{switch(l.toLowerCase()){case"whatsapp":return"WhatsApp";case"instagram":return"Instagram";case"messenger":return"Messenger";case"telegram":return"Telegram";default:return l}})(),"..."),className:"w-full bg-neutral-700 border border-neutral-600 rounded-lg px-4 py-3 pr-12 text-accent-cream placeholder-neutral-400 resize-none focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent max-h-32 disabled:opacity-50 disabled:cursor-not-allowed",rows:1,disabled:p||x,maxLength:c}),h.length>0&&(0,a.jsxs)("div",{className:"absolute bottom-1 right-3 text-xs ".concat(h.length>.9*c?"text-yellow-400":h.length>.95*c?"text-red-400":"text-neutral-500"),children:[h.length,"/",c]})]}),(0,a.jsx)(u,{message:h,onResponseGenerated:e=>{g(e),setTimeout(()=>{E()},500)},onAnalysisComplete:e=>{},disabled:x}),(0,a.jsx)("button",{onClick:E,disabled:!h.trim()||p||x||h.length>c||!b(l),className:"flex-shrink-0 p-3 rounded-lg transition-colors ".concat(h.trim()&&!p&&!x&&h.length<=c&&b(l)?"bg-green-600 text-accent-cream hover:bg-green-700":"bg-neutral-600 text-neutral-400 cursor-not-allowed"),title:h.length>c?"Mensaje demasiado largo (".concat(h.length,"/").concat(c,")"):b(l)?"Enviar mensaje":"L\xedmite de mensajes alcanzado (".concat(w(l),"/").concat(y(l),")"),children:p?(0,a.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]}),C&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-neutral-700 rounded-lg border border-neutral-600",children:(0,a.jsx)("div",{className:"grid grid-cols-8 gap-2",children:["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0D","\uD83E\uDD14","\uD83D\uDC4D","\uD83D\uDC4E","❤️","\uD83D\uDD25","\uD83C\uDF89","\uD83D\uDC4F","\uD83D\uDE22","\uD83D\uDE21","\uD83E\uDD37","\uD83D\uDE4F","\uD83D\uDCAF","✨"].map(e=>(0,a.jsx)("button",{onClick:()=>I(e),className:"text-2xl hover:bg-neutral-600 rounded p-1 transition-colors",children:e},e))})}),(0,a.jsx)("div",{className:"flex items-center justify-between mt-2 text-xs text-neutral-500",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{children:"Enter para enviar"}),(0,a.jsx)("span",{children:"Shift + Enter para nueva l\xednea"}),j&&(0,a.jsxs)("span",{className:"text-green-400 flex items-center gap-1",children:[(0,a.jsx)("svg",{className:"w-3 h-3 animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("circle",{cx:"12",cy:"12",r:"2"})}),"Escribiendo..."]}),999>y(l)&&(0,a.jsxs)("span",{className:"".concat(2>=N(l)?"text-red-400":"text-neutral-500"),children:[w(l),"/",y(l)," mensajes hoy"]})]})})]})]}):(0,a.jsx)("div",{className:"border-t border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsx)("div",{className:"flex items-center justify-center text-neutral-400",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("svg",{className:"w-8 h-8 mx-auto mb-2 text-neutral-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{className:"text-sm",children:"Selecciona una conversaci\xf3n para enviar mensajes"})]})})})}var h=s(52686),g=s(16463);function p(){var e;let{token:t}=(0,n.a)(),{refreshInbox:s}=(0,l.p)(),m=(0,g.useSearchParams)().get("contact"),[u,p]=(0,o.useState)("whatsapp"),[f,j]=(0,o.useState)(null),[v,b]=(0,o.useState)(""),{data:N,mutate:w,isLoading:y}=(0,r.ZP)(t?["/integrations/conversations",u]:null,async e=>{let s,a,[r,n]=e;"telegram"===n?(s="/telegram/chats",a="chats"):(s="".concat(r,"?provider=").concat(n),a="conversations");let l=await fetch("".concat("https://nexly-production.up.railway.app").concat(s),{headers:{Authorization:"Bearer ".concat(t)}}),o=await l.json();return o[a]?o.conversations=o[a].map(e=>{let t=e.contactName||e.title||e.name;return"telegram"!==n||t||(t=e.username||e.firstName||e.lastName||"Usuario Desconocido"),t||(t="Sin nombre"),{id:String(e.id),title:t,last:e.lastMessage||e.last||"\xdaltimo mensaje no disponible",at:e.lastMessageTime||e.at||new Date().toISOString(),unread:e.unreadCount>0,platform:e.provider||n,avatar:e.avatar,chatType:e.chatType,telegramUsername:e.telegramUsername,contactPhone:e.contactPhone}}):o.conversations=[],o},{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:1e4}),k=(null==N?void 0:N.conversations)||[],{data:S,isLoading:C}=(0,r.ZP)(m&&t?"/contacts/".concat(m):null,async e=>{let s=await fetch("".concat("https://nexly-production.up.railway.app").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(!s.ok)throw Error("Contact not found");return s.json()});async function L(e){if(t&&f)try{let s;s="telegram"===u?"/telegram/send-message":"/integrations/conversations/".concat(f,"/reply");let a=await fetch("".concat("https://nexly-production.up.railway.app").concat(s),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({message:e,..."telegram"===u&&{chatId:f}})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.message||"Error ".concat(a.status,": ").concat(a.statusText))}await w(),await new Promise(e=>setTimeout(e,200)),window.dispatchEvent(new CustomEvent("messageSent",{detail:{threadId:f}}))}catch(e){throw console.error("Error enviando mensaje:",e),e}}return(0,o.useEffect)(()=>{if(m&&S&&N){var e;console.log("Auto-selecting conversation for contact:",{contactId:m,contactData:S,conversationsCount:(null===(e=N.conversations)||void 0===e?void 0:e.length)||0});let t=S.provider;t&&h.pD.includes(t)&&(p(t),console.log("Set channel to:",t));let s=N.conversations||[];console.log("Available conversations:",s.map(e=>({id:e.id,title:e.title,contactId:e.contactId,contactPhone:e.contactPhone,telegramUsername:e.telegramUsername})));let a=s.find(e=>{var t,s;return e.id===m||e.contactId===m?(console.log("Found by ID match:",e.id),!0):S.phone&&e.contactPhone===S.phone?(console.log("Found by phone match:",e.contactPhone),!0):(null===(t=S.platformData)||void 0===t?void 0:t.telegramUsername)&&e.telegramUsername===S.platformData.telegramUsername?(console.log("Found by Telegram username:",e.telegramUsername),!0):!!(S.name&&(null===(s=e.title)||void 0===s?void 0:s.toLowerCase().includes(S.name.toLowerCase())))&&(console.log("Found by name match:",e.title),!0)});a?(console.log("Auto-selecting conversation:",a.id),j(a.id)):console.log("No matching conversation found")}},[m,S,N]),(0,o.useEffect)(()=>{s(),m||j(null)},[u,s,m]),(0,a.jsxs)("div",{className:"h-full flex flex-col bg-accent-dark text-accent-cream",children:[(0,a.jsxs)("div",{className:"border-b border-neutral-700 bg-neutral-800 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 sm:p-4",children:[(0,a.jsx)("div",{className:"flex gap-1 sm:gap-2 overflow-x-auto",children:h.pD.map(e=>(0,a.jsxs)("button",{onClick:()=>p(e),disabled:y,className:"px-2 sm:px-4 py-1 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors capitalize flex items-center gap-1 sm:gap-2 whitespace-nowrap ".concat(u===e?"bg-green-600 text-accent-cream shadow-lg":"bg-neutral-700 text-neutral-300 hover:bg-neutral-600"," ").concat(y?"opacity-50 cursor-not-allowed":""),children:[y&&u===e&&(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 sm:h-4 sm:w-4 border-b-2 border-white"}),e]},e))}),(0,a.jsxs)("div",{className:"flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-neutral-400",children:[m&&C&&(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-blue-400",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-400"}),"Cargando contacto..."]}),m&&S&&(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2 text-green-400",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),S.name||S.phone||"Contacto seleccionado"]}),(0,a.jsxs)("span",{className:"whitespace-nowrap",children:[(null==N?void 0:null===(e=N.conversations)||void 0===e?void 0:e.length)||0," conv."]})]})]}),(0,a.jsx)("div",{className:"px-2 sm:px-4 pb-2 sm:pb-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Buscar en ".concat(u,"..."),value:v,onChange:e=>b(e.target.value),className:"w-full bg-neutral-700 border border-neutral-600 rounded-lg px-3 sm:px-4 py-2 pl-8 sm:pl-10 text-accent-cream placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm"}),(0,a.jsx)("div",{className:"absolute left-2 sm:left-3 top-2.5 text-neutral-400",children:(0,a.jsx)("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})})]}),(0,a.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(0,a.jsx)("div",{className:"".concat(f?"hidden lg:flex":"flex"," w-full lg:w-80 border-r border-neutral-700 bg-neutral-800 flex-col h-screen overflow-hidden"),children:(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:y?(0,a.jsx)("div",{className:"p-4 space-y-2",children:Array.from({length:8}).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3",children:[(0,a.jsx)(i.O,{className:"h-12 w-12 rounded-full flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(i.O,{className:"h-4 w-24"}),(0,a.jsx)(i.O,{className:"h-3 w-12"})]}),(0,a.jsx)(i.O,{className:"h-3 w-32"})]})]},t))}):(0,a.jsx)(c,{items:k,activeId:f,onSelect:j,searchQuery:v})})}),(0,a.jsxs)("div",{className:"".concat(f?"flex":"hidden lg:flex"," flex-1 flex-col h-screen overflow-hidden"),children:[f&&(0,a.jsx)("div",{className:"lg:hidden border-b border-neutral-700 bg-neutral-800 p-2",children:(0,a.jsxs)("button",{onClick:()=>j(null),className:"flex items-center gap-2 text-sm text-neutral-300 hover:text-accent-cream transition-colors",children:[(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Volver a conversaciones"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:y?(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-accent-dark",children:[(0,a.jsx)("div",{className:"border-b border-neutral-700 bg-neutral-800 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(i.O,{className:"h-10 w-10 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-32"}),(0,a.jsx)(i.O,{className:"h-3 w-20"})]}),(0,a.jsx)(i.O,{className:"h-6 w-6 rounded"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:Array.from({length:6}).map((e,t)=>(0,a.jsx)("div",{className:t%2==0?"flex justify-start":"flex justify-end",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.O,{className:"h-4 w-32"}),(0,a.jsx)(i.O,{className:"h-3 w-16"})]})},t))})]}):(0,a.jsx)(d,{threadId:f,token:t||"",channel:u})}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(x,{threadId:f,token:t||"",onSend:L,channel:u})})]})]})]})}},2183:(e,t,s)=>{"use strict";s.d(t,{O:()=>n});var a=s(57437),r=s(44839);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,r.Z)("animate-pulse rounded-md bg-neutral-700",t),...s})}},67048:(e,t,s)=>{"use strict";s.d(t,{a:()=>r});var a=s(2265);function r(){let[e,t]=(0,a.useState)(null),[s,r]=(0,a.useState)(null),[n,l]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),s=localStorage.getItem("user");if(e&&s)try{let a=JSON.parse(s);r(e),t(a)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}l(!1)},[]),{user:e,token:s,setAuth:(e,s)=>{r(e),t(s),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(s))},clear:()=>{r(null),t(null),localStorage.removeItem("token"),localStorage.removeItem("user")},logout:()=>{console.log("\uD83D\uDD04 Logout manual iniciado..."),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),window.location.replace("/login")},isLoading:n,isAuthenticated:!!s&&!!e}}},25164:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(2265),r=s(29039);function n(){let e=(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/integrations"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/contacts"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/inbox"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/messages"===e[0]),(0,r.JG)(e=>Array.isArray(e)&&"/conversations"===e[0])},[]),t=(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/integrations"===e[0])},[]),s=(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/contacts"===e[0])},[]);return{refreshAll:e,refreshIntegrations:t,refreshContacts:s,refreshInbox:(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/inbox"===e[0])},[]),refreshMessages:(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/messages"===e[0])},[]),refreshConversations:(0,a.useCallback)(()=>{(0,r.JG)(e=>Array.isArray(e)&&"/conversations"===e[0])},[])}}},92800:(e,t,s)=>{"use strict";s.d(t,{SC:()=>n,T5:()=>a,ZP:()=>m,aS:()=>c,oJ:()=>d,qL:()=>l,qi:()=>i,x4:()=>o});let a="https://nexly-production.up.railway.app".replace(/\/+$/,""),r=e=>"".concat(a).concat(e.startsWith("/")?e:"/".concat(e));async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,a=s||function(){if("undefined"==typeof document)return;let e=document.cookie.match(/(?:^|;\s*)token=([^;]+)/);return e?decodeURIComponent(e[1]):void 0}(),n=await fetch(r(e),{...t,headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...t.headers||{}}});if(!n.ok){if(401===n.status)throw console.warn("\uD83D\uDD12 Token expirado detectado en:",e),console.warn("\uD83D\uDCC5 Timestamp:",new Date().toISOString()),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),console.warn("\uD83D\uDE80 Ejecutando logout autom\xe1tico..."),window.location.replace("/login"),Error("Sesi\xf3n expirada. Redirigiendo al login...");let t="HTTP ".concat(n.status);try{let e=await n.json();t=(null==e?void 0:e.message)||(null==e?void 0:e.error)||t}catch(e){}throw Error(t)}if(204!==n.status)return await n.json()}function l(e){return n("/auth/register",{method:"POST",body:JSON.stringify(e)})}function o(e){return n("/contacts/sync",{method:"POST"},e)}function c(e,t){return n("/contacts/sync/provider/".concat(e),{method:"POST"},t)}function i(e,t){let s=localStorage.getItem("token");return n("/ai/analyze",{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)}},body:JSON.stringify({message:e,context:t})})}function d(e,t){let s=localStorage.getItem("token");return n("/ai/generate-response",{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)}},body:JSON.stringify({message:e,businessContext:t})})}let m=n},52686:(e,t,s)=>{"use strict";s.d(t,{Du:()=>r,pD:()=>a});let a=["whatsapp","instagram","messenger","telegram"],r=[{id:"whatsapp",label:"WhatsApp",color:"bg-green-500",description:"Conecta tu cuenta de WhatsApp Business para enviar y recibir mensajes."},{id:"instagram",label:"Instagram",color:"bg-gradient-to-r from-purple-500 to-pink-500",description:"Conecta tu cuenta de Instagram para gestionar mensajes directos."},{id:"messenger",label:"Facebook Messenger",color:"bg-blue-500",description:"Conecta Facebook Messenger para gestionar conversaciones."},{id:"tiktok",label:"TikTok",color:"bg-black",description:"Conecta TikTok para gestionar mensajes y comentarios."},{id:"telegram",label:"Telegram",color:"bg-blue-500",description:"Conecta tu cuenta personal de Telegram para gestionar todos tus chats y mensajes."}]},44839:(e,t,s)=>{"use strict";function a(){for(var e,t,s=0,a="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=function e(t){var s,a,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var n=t.length;for(s=0;s<n;s++)t[s]&&(a=e(t[s]))&&(r&&(r+=" "),r+=a)}else for(a in t)t[a]&&(r&&(r+=" "),r+=a)}return r}(e))&&(a&&(a+=" "),a+=t);return a}s.d(t,{W:()=>a,Z:()=>r});let r=a}},e=>{var t=t=>e(e.s=t);e.O(0,[9039,7130,6215,1744],()=>t(7126)),_N_E=e.O()}]);