(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6436],{86359:(e,t,a)=>{Promise.resolve().then(a.bind(a,80751))},80751:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var s=a(57437),r=a(2265),n=a(16463),c=a(95137),l=a(3274),o=a(76780),i=a(86763),d=a(92800),m=a(78030);let u=(0,m.Z)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),x=(0,m.Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var h=a(47390);let g=(0,m.Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),j=(0,m.Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var p=a(67048);function v(e){let{integration:t,onDisconnect:a}=e,{token:n}=(0,p.a)(),[c,o]=(0,r.useState)([]),[m,v]=(0,r.useState)(null),[N,b]=(0,r.useState)([]),[f,y]=(0,r.useState)(!1),[w,S]=(0,r.useState)(!1),[k,C]=(0,r.useState)(!1),T=async()=>{y(!0);try{let e=await (0,d.SC)("/telegram/chats",{},n||void 0);e.success?o(e.chats||[]):i.C.error("Error cargando chats")}catch(e){console.error("Error cargando chats:",e),i.C.error("Error cargando chats")}finally{y(!1)}},E=async e=>{S(!0);try{let t=await (0,d.SC)("/telegram/messages/".concat(e,"?limit=20"),{},n||void 0);t.success?b(t.messages||[]):i.C.error("Error cargando mensajes")}catch(e){console.error("Error cargando mensajes:",e),i.C.error("Error cargando mensajes")}finally{S(!1)}},I=async()=>{if(confirm("\xbfEst\xe1s seguro de que quieres desconectar Telegram? Esto eliminar\xe1 el acceso a todos tus chats.")){C(!0);try{(await (0,d.SC)("/telegram/disconnect",{method:"DELETE"},n||void 0)).success?(i.C.success("Telegram desconectado exitosamente"),null==a||a()):i.C.error("Error desconectando Telegram")}catch(e){console.error("Error desconectando:",e),i.C.error("Error desconectando Telegram")}finally{C(!1)}}},Z=e=>{v(e),E(e.id)};(0,r.useEffect)(()=>{T()},[]);let M=e=>{switch(e){case"private":default:return(0,s.jsx)(u,{className:"w-4 h-4"});case"group":case"supergroup":return(0,s.jsx)(x,{className:"w-4 h-4"});case"channel":return(0,s.jsx)(h.Z,{className:"w-4 h-4"})}},O=e=>{switch(e){case"private":return"Privado";case"group":return"Grupo";case"supergroup":return"Supergrupo";case"channel":return"Canal";default:return"Chat"}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-neutral-800 rounded-lg p-6 border border-neutral-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4",children:(0,s.jsx)(h.Z,{className:"w-6 h-6 text-accent-cream"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-accent-cream",children:t.name}),(0,s.jsx)("p",{className:"text-neutral-400",children:t.meta.telegramUsername?"@".concat(t.meta.telegramUsername):t.meta.telegramPhoneNumber})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(t.meta.isActive?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"),children:t.meta.isActive?"Activo":"Inactivo"}),(0,s.jsx)("button",{onClick:I,disabled:k,className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors duration-200 disabled:opacity-50",children:k?(0,s.jsx)(l.Z,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(g,{className:"w-5 h-5"})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-neutral-400",children:"ID de Usuario:"}),(0,s.jsx)("p",{className:"text-accent-cream font-mono",children:t.meta.telegramUserId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-neutral-400",children:"Nombre:"}),(0,s.jsxs)("p",{className:"text-accent-cream",children:[t.meta.telegramFirstName," ",t.meta.telegramLastName]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-neutral-400",children:"Tel\xe9fono:"}),(0,s.jsx)("p",{className:"text-accent-cream",children:t.meta.telegramPhoneNumber})]})]})]}),(0,s.jsxs)("div",{className:"bg-neutral-800 rounded-lg border border-neutral-700",children:[(0,s.jsx)("div",{className:"p-4 border-b border-neutral-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-accent-cream",children:"Tus Chats"}),(0,s.jsx)("button",{onClick:T,disabled:f,className:"p-2 text-neutral-400 hover:text-accent-cream hover:bg-neutral-700 rounded-lg transition-colors duration-200 disabled:opacity-50",children:f?(0,s.jsx)(l.Z,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(j,{className:"w-5 h-5"})})]})}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto",children:f?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)(l.Z,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-400"}),(0,s.jsx)("p",{className:"text-neutral-400",children:"Cargando chats..."})]}):0===c.length?(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)(h.Z,{className:"w-12 h-12 mx-auto mb-4 text-neutral-600"}),(0,s.jsx)("p",{className:"text-neutral-400",children:"No se encontraron chats"})]}):(0,s.jsx)("div",{className:"divide-y divide-neutral-700",children:c.map(e=>(0,s.jsx)("button",{onClick:()=>Z(e),className:"w-full p-4 text-left hover:bg-neutral-700 transition-colors duration-200 ".concat((null==m?void 0:m.id)===e.id?"bg-neutral-700":""),children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center mr-3",children:M(e.type)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-accent-cream font-medium truncate",children:e.title||"Chat ".concat(e.id)}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-neutral-400",children:[(0,s.jsx)("span",{children:O(e.type)}),e.username&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{children:["@",e.username]})]})]})]})]})},e.id))})})]}),m&&(0,s.jsxs)("div",{className:"bg-neutral-800 rounded-lg border border-neutral-700",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-neutral-700",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-accent-cream",children:m.title||"Chat ".concat(m.id)}),(0,s.jsxs)("p",{className:"text-sm text-neutral-400",children:[O(m.type),m.username&&" • @".concat(m.username)]})]}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto p-4",children:w?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(l.Z,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-blue-400"}),(0,s.jsx)("p",{className:"text-neutral-400",children:"Cargando mensajes..."})]}):0===N.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(u,{className:"w-12 h-12 mx-auto mb-4 text-neutral-600"}),(0,s.jsx)("p",{className:"text-neutral-400",children:"No hay mensajes en este chat"})]}):(0,s.jsx)("div",{className:"space-y-3",children:N.map(e=>(0,s.jsxs)("div",{className:"p-3 rounded-lg ".concat(e.isOutgoing?"bg-blue-500/20 ml-8":"bg-neutral-700 mr-8"),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-xs text-neutral-400",children:e.isOutgoing?"T\xfa":"Otro"}),(0,s.jsx)("span",{className:"text-xs text-neutral-500",children:new Date(e.date).toLocaleString()})]}),(0,s.jsx)("p",{className:"text-accent-cream text-sm",children:e.text||"[Mensaje sin texto]"})]},e.id))})})]})]})}function N(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{g()},[]);let g=async()=>{try{u(!0),h(null);let e=await (0,d.SC)("/integrations");if(e.success){let t=e.integrations.find(e=>"telegram"===e.provider&&"linked"===e.status);t?a(t):h("No se encontr\xf3 una integraci\xf3n de Telegram activa")}else throw Error(e.message||"Error cargando integraci\xf3n")}catch(e){console.error("Error cargando integraci\xf3n:",e),h(e.message||"Error cargando integraci\xf3n de Telegram")}finally{u(!1)}};return m?(0,s.jsx)("div",{className:"min-h-screen bg-accent-dark p-6",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center text-neutral-400 hover:text-accent-cream transition-colors duration-200 mb-6",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 mr-2"}),"Volver"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-accent-cream mb-2",children:"Gestionar Telegram"})]}),(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.Z,{className:"w-12 h-12 animate-spin mx-auto mb-4 text-blue-400"}),(0,s.jsx)("p",{className:"text-neutral-400",children:"Cargando integraci\xf3n de Telegram..."})]})})]})}):x||!t?(0,s.jsx)("div",{className:"min-h-screen bg-accent-dark p-6",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center text-neutral-400 hover:text-accent-cream transition-colors duration-200 mb-6",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 mr-2"}),"Volver"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-accent-cream mb-2",children:"Gestionar Telegram"})]}),(0,s.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-8",children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)(o.Z,{className:"w-8 h-8 text-red-400 mr-4"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-red-400 mb-1",children:x?"Error cargando Telegram":"Telegram no conectado"}),(0,s.jsx)("p",{className:"text-red-300",children:x||"No tienes una integraci\xf3n de Telegram activa. Conecta tu cuenta para comenzar."})]})]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{onClick:()=>e.push("/dashboard/integrations/connect/telegram"),className:"bg-blue-500 hover:bg-blue-600 text-accent-cream font-medium py-2 px-6 rounded-lg transition-colors duration-200",children:"Conectar Telegram"}),(0,s.jsx)("button",{onClick:()=>e.push("/dashboard/integrations"),className:"bg-neutral-600 hover:bg-neutral-700 text-accent-cream font-medium py-2 px-6 rounded-lg transition-colors duration-200",children:"Ver todas las integraciones"})]})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-accent-dark p-6",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center text-neutral-400 hover:text-accent-cream transition-colors duration-200 mb-6",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 mr-2"}),"Volver"]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-accent-cream mb-2",children:"Gestionar Telegram"}),(0,s.jsx)("p",{className:"text-neutral-400",children:"Gestiona todos tus chats y mensajes de Telegram desde una sola plataforma."})]}),(0,s.jsx)(v,{integration:t,onDisconnect:()=>{a(null),i.C.success("Telegram desconectado exitosamente"),e.push("/dashboard/integrations")}})]})})}},86763:(e,t,a)=>{"use strict";a.d(t,{C:()=>r});var s=a(88726);let r={success:e=>s.Am.success(e),error:e=>s.Am.error(e),loading:e=>s.Am.loading(e),dismiss:e=>s.Am.dismiss(e)}},67048:(e,t,a)=>{"use strict";a.d(t,{a:()=>r});var s=a(2265);function r(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),[n,c]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=localStorage.getItem("token"),a=localStorage.getItem("user");if(e&&a)try{let s=JSON.parse(a);r(e),t(s)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("user")}c(!1)},[]),{user:e,token:a,setAuth:(e,a)=>{r(e),t(a),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(a))},clear:()=>{r(null),t(null),localStorage.removeItem("token"),localStorage.removeItem("user")},logout:()=>{console.log("\uD83D\uDD04 Logout manual iniciado..."),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),window.location.replace("/login")},isLoading:n,isAuthenticated:!!a&&!!e}}},92800:(e,t,a)=>{"use strict";a.d(t,{SC:()=>n,T5:()=>s,ZP:()=>m,aS:()=>o,oJ:()=>d,qL:()=>c,qi:()=>i,x4:()=>l});let s="https://nexly-production.up.railway.app".replace(/\/+$/,""),r=e=>"".concat(s).concat(e.startsWith("/")?e:"/".concat(e));async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,s=a||function(){if("undefined"==typeof document)return;let e=document.cookie.match(/(?:^|;\s*)token=([^;]+)/);return e?decodeURIComponent(e[1]):void 0}(),n=await fetch(r(e),{...t,headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},...t.headers||{}}});if(!n.ok){if(401===n.status)throw console.warn("\uD83D\uDD12 Token expirado detectado en:",e),console.warn("\uD83D\uDCC5 Timestamp:",new Date().toISOString()),localStorage.removeItem("token"),localStorage.removeItem("user"),document.cookie="token=; Path=/; Max-Age=0; SameSite=Lax",sessionStorage.clear(),console.warn("\uD83D\uDE80 Ejecutando logout autom\xe1tico..."),window.location.replace("/login"),Error("Sesi\xf3n expirada. Redirigiendo al login...");let t="HTTP ".concat(n.status);try{let e=await n.json();t=(null==e?void 0:e.message)||(null==e?void 0:e.error)||t}catch(e){}throw Error(t)}if(204!==n.status)return await n.json()}function c(e){return n("/auth/register",{method:"POST",body:JSON.stringify(e)})}function l(e){return n("/contacts/sync",{method:"POST"},e)}function o(e,t){return n("/contacts/sync/provider/".concat(e),{method:"POST"},t)}function i(e,t){let a=localStorage.getItem("token");return n("/ai/analyze",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}},body:JSON.stringify({message:e,context:t})})}function d(e,t){let a=localStorage.getItem("token");return n("/ai/generate-response",{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}},body:JSON.stringify({message:e,businessContext:t})})}let m=n}},e=>{var t=t=>e(e.s=t);e.O(0,[5132,7130,6215,1744],()=>t(86359)),_N_E=e.O()}]);